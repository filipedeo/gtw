import{u as G,r as a,i as K,g as U,n as _,N as B,a as F,p as v,j as e,F as J,b as V}from"./index-CaEio-N4.js";import{u as X}from"./useExercise-Byvmrw_d.js";import{D as R}from"./DisplayModeToggle-G3aLmAKp.js";import"./tone-xN27a9Rt.js";const se=({exercise:u})=>{const{stringCount:N,tuning:j,setHighlightedPositions:b,setRootNote:w,clearHighlights:p}=G(),{score:c,questionNumber:T,isActive:l,recordAnswer:k,scorePercentage:D}=X({exerciseId:u.id,totalQuestions:10}),[n,M]=a.useState(null),[m,O]=a.useState(""),[d,q]=a.useState(""),[x,I]=a.useState([]),[o,S]=a.useState(null),[f,C]=a.useState(null),[$,P]=a.useState(!1),[Q,h]=a.useState([]),A=a.useRef(()=>{});a.useEffect(()=>{const t=r=>{if(!l||o!==null)return;const s={1:0,2:1,3:2,4:3};if(r.key in s){const i=s[r.key];i<x.length&&(r.preventDefault(),A.current(x[i]))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[l,o,x]);const g=u.difficulty<=1?5:u.difficulty<=2?12:22,y=a.useCallback(async()=>{await K();const t=V(N,g,0),r=U(t,j),s=r.replace(/\d/,""),i=_(s),H=B.filter(W=>!F(W,i)).sort(()=>Math.random()-.5).slice(0,3),L=[i,...H].sort(()=>Math.random()-.5);M(t),O(i),q(r),I(L),S(null),C(null),P(!1),h([]),b([t]),w(null),setTimeout(()=>{v(r,{duration:1.5,velocity:.7})},300)},[N,j,g,b,w]);a.useEffect(()=>(l?y():(p(),h([])),()=>{p(),h([])}),[l,y,p]);const z=()=>{d&&v(d,{duration:1.5,velocity:.7})},E=a.useCallback(t=>{if(o!==null||!l||!n)return;S(t);const r=F(t,m);C(r),P(!0),h([n]),k(r),v(d,{duration:1,velocity:.6}),setTimeout(()=>{c.total+1<10&&y()},2e3)},[o,l,n,m,d,c.total,k,y]);return A.current=E,l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Question ",T," of 10"]}),e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Score: ",c.correct,"/",c.total,c.total>0&&e.jsxs("span",{style:{color:"var(--text-muted)"},className:"ml-2",children:["(",D,"%)"]})]})]}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(R,{compact:!0})}),e.jsx("div",{className:"card p-4",children:e.jsx(J,{interactive:!1,hideNoteNames:!0,revealedPositions:Q})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--text-primary)"},children:"What note is highlighted on the fretboard?"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[n&&e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["String ",n.string+1,", Fret ",n.fret]}),e.jsx("button",{onClick:z,className:"btn-secondary text-sm flex items-center gap-1",disabled:o!==null,children:"ðŸ”Š Play Again"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-2xl mx-auto",role:"group","aria-label":"Answer options. Press 1, 2, 3, or 4 to select an answer",children:x.map((t,r)=>{let s={padding:"1rem 1.5rem",borderRadius:"0.5rem",fontWeight:"bold",fontSize:"1.125rem",transition:"all 0.2s",border:"none",cursor:o===null?"pointer":"default"};return o===null?(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-primary)"):t===m?(s.backgroundColor="var(--success)",s.color="white"):t===o?(s.backgroundColor="var(--error)",s.color="white"):(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-muted)",s.opacity=.5),e.jsxs("button",{onClick:()=>E(t),disabled:o!==null,style:s,className:"hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":`Option ${r+1}: ${t}. Press ${r+1} to select`,"aria-pressed":o===t,children:[e.jsxs("span",{className:"sr-only",children:[r+1,": "]}),t]},t)})}),e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{"aria-hidden":"true",children:"Tip: Press 1, 2, 3, or 4 to quickly select an answer"}),e.jsx("span",{className:"sr-only",children:"Use number keys 1 through 4 to select answers"})]}),$&&e.jsxs("div",{className:"text-center p-4 rounded-lg animate-fade-in",style:{backgroundColor:f?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)"},role:"alert","aria-live":"assertive",children:[e.jsxs("p",{className:"font-medium text-lg",style:{color:f?"var(--success)":"var(--error)"},children:[e.jsx("span",{"aria-hidden":"true",children:f?"âœ“":"âœ—"}),f?" Correct!":` Incorrect. The answer was ${m}`]}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:[d," - String ",n?n.string+1:"",", Fret ",n?.fret]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{style:{color:"var(--text-secondary)"},className:"mb-4",children:'Click "Start Exercise" to begin identifying notes on the fretboard.'}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm",style:{color:"var(--text-muted)"},children:[e.jsxs("span",{children:["Difficulty: ",u.difficulty,"/5"]}),e.jsx("span",{children:"|"}),e.jsxs("span",{children:["Frets: 0-",g]}),e.jsx("span",{children:"|"}),e.jsx("span",{children:"10 questions"})]}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(R,{})})]})};export{se as default};
