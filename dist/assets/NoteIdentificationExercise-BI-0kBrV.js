import{u as W,r as o,i as G,g as K,n as U,N as _,a as F,p as v,j as e,F as B,b as J}from"./index-CqEMcS90.js";import{u as V}from"./useExercise-zChmWmoh.js";import{D as X}from"./DisplayModeToggle-I1_i2FX6.js";import"./tone-BDbzsNEa.js";const se=({exercise:g})=>{const{stringCount:p,tuning:N,setHighlightedPositions:b,setRootNote:j,clearHighlights:y}=W(),{score:c,questionNumber:R,isActive:n,recordAnswer:w,scorePercentage:T}=V({exerciseId:g.id,totalQuestions:10}),[l,M]=o.useState(null),[u,O]=o.useState(""),[d,D]=o.useState(""),[m,I]=o.useState([]),[a,k]=o.useState(null),[x,S]=o.useState(null),[$,C]=o.useState(!1),[q,f]=o.useState([]),P=o.useRef(()=>{});o.useEffect(()=>{const t=r=>{if(!n||a!==null)return;const s={1:0,2:1,3:2,4:3};if(r.key in s){const i=s[r.key];i<m.length&&(r.preventDefault(),P.current(m[i]))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[n,a,m]);const A=g.difficulty<=1?5:g.difficulty<=2?12:22,h=o.useCallback(async()=>{await G();const t=J(p,A,0),r=K(t,N),s=r.replace(/\d/,""),i=U(s),z=_.filter(L=>!F(L,i)).sort(()=>Math.random()-.5).slice(0,3),H=[i,...z].sort(()=>Math.random()-.5);M(t),O(i),D(r),I(H),k(null),S(null),C(!1),f([]),b([t]),j(null),setTimeout(()=>{v(r,{duration:1.5,velocity:.7})},300)},[p,N,A,b,j]);o.useEffect(()=>(n?h():(y(),f([])),()=>{y(),f([])}),[n,h,y]);const Q=()=>{d&&v(d,{duration:1.5,velocity:.7})},E=o.useCallback(t=>{if(a!==null||!n||!l)return;k(t);const r=F(t,u);S(r),C(!0),f([l]),w(r),v(d,{duration:1,velocity:.6}),setTimeout(()=>{c.total+1<10&&h()},2e3)},[a,n,l,u,d,c.total,w,h]);return P.current=E,e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Question ",R," of 10"]}),e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Score: ",c.correct,"/",c.total,c.total>0&&e.jsxs("span",{style:{color:"var(--text-muted)"},className:"ml-2",children:["(",T,"%)"]})]})]}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(X,{compact:!0})}),e.jsx("div",{className:"card p-4",children:e.jsx(B,{interactive:!1,hideNoteNames:!0,revealedPositions:q})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--text-primary)"},children:"What note is highlighted on the fretboard?"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[l&&e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["String ",l.string+1,", Fret ",l.fret]}),e.jsx("button",{onClick:Q,className:"btn-secondary text-sm flex items-center gap-1",disabled:a!==null,children:"ðŸ”Š Play Again"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-2xl mx-auto",role:"group","aria-label":"Answer options. Press 1, 2, 3, or 4 to select an answer",children:m.map((t,r)=>{let s={padding:"1rem 1.5rem",borderRadius:"0.5rem",fontWeight:"bold",fontSize:"1.125rem",transition:"all 0.2s",border:"none",cursor:a===null?"pointer":"default"};return a===null?(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-primary)"):t===u?(s.backgroundColor="var(--success)",s.color="white"):t===a?(s.backgroundColor="var(--error)",s.color="white"):(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-muted)",s.opacity=.5),e.jsxs("button",{onClick:()=>E(t),disabled:a!==null,style:s,className:"hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":`Option ${r+1}: ${t}. Press ${r+1} to select`,"aria-pressed":a===t,children:[e.jsxs("span",{className:"sr-only",children:[r+1,": "]}),t]},t)})}),e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{"aria-hidden":"true",children:"Tip: Press 1, 2, 3, or 4 to quickly select an answer"}),e.jsx("span",{className:"sr-only",children:"Use number keys 1 through 4 to select answers"})]}),$&&e.jsxs("div",{className:"text-center p-4 rounded-lg animate-fade-in",style:{backgroundColor:x?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)"},role:"alert","aria-live":"assertive",children:[e.jsxs("p",{className:"font-medium text-lg",style:{color:x?"var(--success)":"var(--error)"},children:[e.jsx("span",{"aria-hidden":"true",children:x?"âœ“":"âœ—"}),x?" Correct!":` Incorrect. The answer was ${u}`]}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:[d," - String ",l?l.string+1:"",", Fret ",l?.fret]})]})]})};export{se as default};
