import{u as U,d as X,r as t,n as Y,e as D,i as q,h as Q,j as e}from"./index-CrYEXAxW.js";import{a as x,s as W,L as Z,b as ee}from"./tone-BWNjRQgH.js";import{g as re,b as R,N as C}from"./theoryEngine-B3dQahfx.js";import{D as se}from"./DisplayModeToggle-DtggWZSM.js";import{P as te}from"./PracticeRating-PVheSIlz.js";const j=[{name:"12-Bar Blues",numerals:["I","I","I","I","IV","IV","I","I","V","IV","I","V"],degrees:[1,1,1,1,4,4,1,1,5,4,1,5],suggestedScale:"blues",genre:"Blues",beatsPerChord:4},{name:"Minor Blues",numerals:["i","i","i","i","iv","iv","i","i","v","iv","i","v"],degrees:[1,1,1,1,4,4,1,1,5,4,1,5],suggestedScale:"aeolian",genre:"Blues",beatsPerChord:4},{name:"Classic Rock (I-bVII-IV)",numerals:["I","bVII","IV","I"],degrees:[1,"b7",4,1],suggestedScale:"mixolydian",genre:"Rock",beatsPerChord:4},{name:"Rock Anthem (I-IV-V)",numerals:["I","IV","V","V"],degrees:[1,4,5,5],suggestedScale:"ionian",genre:"Rock",beatsPerChord:4},{name:"Sad Rock (vi-IV-I-V)",numerals:["vi","IV","I","V"],degrees:[6,4,1,5],suggestedScale:"aeolian",genre:"Rock",beatsPerChord:4},{name:"ii-V-I",numerals:["ii","V","I","I"],degrees:[2,5,1,1],suggestedScale:"dorian",genre:"Jazz",beatsPerChord:4},{name:"Rhythm Changes (I-vi-ii-V)",numerals:["I","vi","ii","V"],degrees:[1,6,2,5],suggestedScale:"ionian",genre:"Jazz",beatsPerChord:4},{name:"Jazz Turnaround (iii-vi-ii-V)",numerals:["iii","vi","ii","V"],degrees:[3,6,2,5],suggestedScale:"dorian",genre:"Jazz",beatsPerChord:4},{name:"Axis of Awesome (I-V-vi-IV)",numerals:["I","V","vi","IV"],degrees:[1,5,6,4],suggestedScale:"ionian",genre:"Pop",beatsPerChord:4},{name:"Emotional Pop (vi-IV-I-V)",numerals:["vi","IV","I","V"],degrees:[6,4,1,5],suggestedScale:"aeolian",genre:"Pop",beatsPerChord:4}],ae=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],oe={"jam-1":"Blues","jam-2":"Rock","jam-3":"Pop","jam-4":"Jazz"};function G(c){const l=oe[c];if(!l)return 0;const n=j.findIndex(m=>m.genre===l);return n>=0?n:0}function ne(c,l){const n=C.indexOf(c);return n===-1?[]:l.map(m=>{const f=(n+m)%12,b=m>=12?4:3;return`${C[f]}${b}`})}function ce(){const c=new Set,l=[];for(const n of j)c.has(n.genre)||(c.add(n.genre),l.push(n.genre));return l}const me=({exercise:c})=>{const{stringCount:l,tuning:n,fretCount:m,setHighlightedPositions:f,setSecondaryHighlightedPositions:b,setRootNote:z,clearHighlights:A}=U(),{isActive:B}=X(),[u,K]=t.useState("A"),[N,T]=t.useState(()=>G(c.id)),[g,O]=t.useState(100),[P,J]=t.useState(!1),[S,M]=t.useState(0),[V,_]=t.useState(!1),i=t.useRef(null),h=t.useRef(!1),s=j[N],H=ce();t.useEffect(()=>{const r=G(c.id);T(r)},[c.id]);const k=V?m:12;t.useEffect(()=>{if(B)try{const r=Y(u),a=re(r,s.suggestedScale);if(a&&a.length>0){const o=D(a,n,l,k);f(o),z(r);const d=R(u,s.degrees);if(d.length>0){const p=d[S%d.length],y=p.intervals.map(w=>{const E=C.indexOf(p.root);return C[(E+w)%12]}),I=D(y,n,l,k);b(I)}}}catch(r){console.error("Error updating jam fretboard:",r)}},[u,N,S,V,B,l,n,k,s,f,b,z]);const v=t.useCallback(()=>{i.current&&(i.current.stop(),i.current.dispose(),i.current=null),x().stop(),x().cancel(),h.current=!1,J(!1),M(0)},[]),F=t.useCallback(async()=>{await q(),await W();const r=R(u,s.degrees);if(r.length===0)return;const a=x();a.bpm.value=g,a.cancel();let o=0;const d=r.length*s.beatsPerChord;i.current=new Z(p=>{const y=Math.floor(o/s.beatsPerChord)%r.length;if(ee().schedule(()=>{M(y)},p),o%s.beatsPerChord===0){const I=r[y],w=ne(I.root,I.intervals),E=60/g*s.beatsPerChord*.9;Q(w,{duration:E})}o=(o+1)%d},"4n"),i.current.start(0),a.start(),h.current=!0,J(!0)},[u,s,g]),$=t.useCallback(async()=>{h.current?v():await F()},[F,v]);t.useEffect(()=>{h.current&&(x().bpm.value=g)},[g]),t.useEffect(()=>()=>{i.current&&(i.current.stop(),i.current.dispose(),i.current=null),x().stop(),x().cancel(),A()},[A]);const L=R(u,s.degrees);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:u,onChange:r=>{K(r.target.value),h.current&&v()},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",style:{borderColor:"var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:ae.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Progression"}),e.jsx("select",{value:N,onChange:r=>{T(parseInt(r.target.value)),h.current&&v()},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",style:{borderColor:"var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:H.map(r=>e.jsx("optgroup",{label:r,children:j.map((a,o)=>a.genre===r?e.jsx("option",{value:o,children:a.name},o):null)},r))})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Tempo"}),e.jsxs("span",{className:"text-sm font-mono",style:{color:"var(--accent-primary)"},children:[g," BPM"]})]}),e.jsx("input",{type:"range",min:60,max:200,value:g,onChange:r=>O(parseInt(r.target.value)),className:"w-full"})]}),e.jsx("button",{onClick:$,className:"px-6 py-2 rounded-lg font-medium transition-colors text-white min-w-[100px]",style:{backgroundColor:P?"var(--error)":"var(--success)"},children:P?"Stop":"Play"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:s.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:s.suggestedScale})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.numerals.map((r,a)=>{const o=a===S&&P,d=L[a],p=d?d.root:"";return e.jsxs("div",{className:"flex flex-col items-center px-3 py-2 rounded-lg transition-all min-w-[48px]",style:{backgroundColor:o?"var(--accent-primary)":"var(--bg-primary)",color:o?"white":"var(--text-primary)",border:`1px solid ${o?"var(--accent-primary)":"var(--border-color)"}`,transform:o?"scale(1.1)":"scale(1)"},children:[e.jsx("span",{className:"text-sm font-bold",children:r}),e.jsx("span",{className:"text-xs opacity-70",children:p})]},a)})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-primary)"},children:[e.jsx("input",{type:"checkbox",checked:V,onChange:r=>_(r.target.checked),className:"rounded"}),"Full fretboard"]}),e.jsx(se,{})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--accent-primary)"},children:[e.jsxs("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:["Suggested Scale: ",s.suggestedScale.charAt(0).toUpperCase()+s.suggestedScale.slice(1)]}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"The scale is highlighted on the fretboard. Chord tones of the current chord are shown with secondary highlights. Target chord tones on beat 1 of each chord change for stronger phrasing."})]}),e.jsx(te,{exerciseId:c.id,exerciseType:c.type})]})};export{me as default};
