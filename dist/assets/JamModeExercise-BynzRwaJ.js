import{u as X,d as Y,r as t,n as q,e as K,i as Q,h as V,j as e,F as W}from"./index-Cay9Vtxh.js";import{a as x,s as Z,L as ee,b as re}from"./tone-BWNjRQgH.js";import{g as se,b as F,N}from"./theoryEngine-DGNflXQT.js";import{J as C}from"./jamProgressions-ClHOGlWa.js";import{D as te}from"./DisplayModeToggle-BpAHNKn2.js";import{P as oe}from"./PracticeRating-DPm74W8O.js";const ae=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],ne={"jam-1":"Blues","jam-2":"Rock","jam-3":"Pop","jam-4":"Jazz"};function O(c){const l=ne[c];if(!l)return 0;const n=C.findIndex(g=>g.genre===l);return n>=0?n:0}function ce(c,l){const n=N.indexOf(c);return n===-1?[]:l.map(g=>{const f=(n+g)%12,b=g>=12?4:3;return`${N[f]}${b}`})}function le(){const c=new Set,l=[];for(const n of C)c.has(n.genre)||(c.add(n.genre),l.push(n.genre));return l}const pe=({exercise:c})=>{const{stringCount:l,tuning:n,fretCount:g,setHighlightedPositions:f,setSecondaryHighlightedPositions:b,setRootNote:A,clearHighlights:T}=X(),{isActive:M}=Y(),[u,z]=t.useState("A"),[S,D]=t.useState(()=>O(c.id)),[m,_]=t.useState(100),[P,B]=t.useState(!1),[w,J]=t.useState(0),[E,H]=t.useState(!1),i=t.useRef(null),h=t.useRef(!1),s=C[S],$=le();t.useEffect(()=>{const r=O(c.id);D(r)},[c.id]);const k=E?g:12;t.useEffect(()=>{if(M)try{const r=q(u),o=se(r,s.suggestedScale);if(o&&o.length>0){const a=K(o,n,l,k);f(a),A(r);const d=F(u,s.degrees);if(d.length>0){const p=d[w%d.length],v=p.intervals.map(I=>{const R=N.indexOf(p.root);return N[(R+I)%12]}),j=K(v,n,l,k);b(j)}}}catch(r){console.error("Error updating jam fretboard:",r)}},[u,S,w,E,M,l,n,k,s,f,b,A]);const y=t.useCallback(()=>{i.current&&(i.current.stop(),i.current.dispose(),i.current=null),x().stop(),x().cancel(),h.current=!1,B(!1),J(0)},[]),G=t.useCallback(async()=>{await Q(),await Z();const r=F(u,s.degrees);if(r.length===0)return;const o=x();o.bpm.value=m,o.cancel();let a=0;const d=r.length*s.beatsPerChord;i.current=new ee(p=>{const v=Math.floor(a/s.beatsPerChord)%r.length;if(re().schedule(()=>{J(v)},p),a%s.beatsPerChord===0){const j=r[v],I=ce(j.root,j.intervals),R=60/m*s.beatsPerChord*.9;V(I,{duration:R})}a=(a+1)%d},"4n"),i.current.start(0),o.start(),h.current=!0,B(!0)},[u,s,m]),L=t.useCallback(async()=>{h.current?y():await G()},[G,y]);t.useEffect(()=>{h.current&&(x().bpm.value=m)},[m]),t.useEffect(()=>()=>{i.current&&(i.current.stop(),i.current.dispose(),i.current=null),x().stop(),x().cancel(),T()},[T]);const U=F(u,s.degrees);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:u,onChange:r=>{z(r.target.value),h.current&&y()},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",style:{borderColor:"var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:ae.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Progression"}),e.jsx("select",{value:S,onChange:r=>{D(parseInt(r.target.value)),h.current&&y()},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",style:{borderColor:"var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:$.map(r=>e.jsx("optgroup",{label:r,children:C.map((o,a)=>o.genre===r?e.jsx("option",{value:a,children:o.name},a):null)},r))})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Tempo"}),e.jsxs("span",{className:"text-sm font-mono",style:{color:"var(--accent-primary)"},children:[m," BPM"]})]}),e.jsx("input",{type:"range",min:60,max:200,value:m,onChange:r=>_(parseInt(r.target.value)),className:"w-full"})]}),e.jsx("button",{onClick:L,className:"px-6 py-2 rounded-lg font-medium transition-colors text-white min-w-[100px]",style:{backgroundColor:P?"var(--error)":"var(--success)"},children:P?"Stop":"Play"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:s.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:s.suggestedScale})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.numerals.map((r,o)=>{const a=o===w&&P,d=U[o],p=d?d.root:"";return e.jsxs("div",{className:"flex flex-col items-center px-3 py-2 rounded-lg transition-all min-w-[48px]",style:{backgroundColor:a?"var(--accent-primary)":"var(--bg-primary)",color:a?"white":"var(--text-primary)",border:`1px solid ${a?"var(--accent-primary)":"var(--border-color)"}`,transform:a?"scale(1.1)":"scale(1)"},children:[e.jsx("span",{className:"text-sm font-bold",children:r}),e.jsx("span",{className:"text-xs opacity-70",children:p})]},o)})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-primary)"},children:[e.jsx("input",{type:"checkbox",checked:E,onChange:r=>H(r.target.checked),className:"rounded"}),"Full fretboard"]}),e.jsx(te,{})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--accent-primary)"},children:[e.jsxs("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:["Suggested Scale: ",s.suggestedScale.charAt(0).toUpperCase()+s.suggestedScale.slice(1)]}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"The scale is highlighted on the fretboard. Chord tones of the current chord are shown with secondary highlights. Target chord tones on beat 1 of each chord change for stronger phrasing."})]}),e.jsx("div",{className:"card p-4",children:e.jsx(W,{interactive:!0})}),e.jsx(oe,{exerciseId:c.id,exerciseType:c.type})]})};export{pe as default};
