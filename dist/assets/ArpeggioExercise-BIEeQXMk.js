import{u as se,c as oe,d as re,r as a,n as Q,e as G,s as Y,j as e,F as ae,q as ne,i as B,f as ie,p as ce}from"./index-B3UTKWKW.js";import{c as R}from"./theoryEngine-BiTKQURU.js";import{D as le}from"./DisplayModeToggle-DIispu4g.js";import{P as de}from"./PracticeRating-BS5RI7Dd.js";import"./tone-BWNjRQgH.js";const me=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],he=[{value:"maj7",label:"Major 7",symbol:"maj7"},{value:"min7",label:"Minor 7",symbol:"m7"},{value:"dom7",label:"Dominant 7",symbol:"7"},{value:"min7b5",label:"Half-Diminished",symbol:"m7b5"},{value:"dim7",label:"Diminished 7",symbol:"dim7"},{value:"aug",label:"Augmented",symbol:"aug"}],ue={"bass-arp-1":"maj7","bass-arp-2":"min7","bass-arp-3":"dom7","bass-arp-4":"min7","guitar-arp-1":"maj7","guitar-arp-2":"min7","guitar-arp-3":"dom7","guitar-arp-4":"dim7","guitar-arp-5":"aug","guitar-arp-6":"min7b5"};function T(r){switch(r){case"maj7":return"maj7";case"min7":return"m7";case"dom7":return"7";case"min7b5":return"m7b5";case"dim7":return"dim7";case"aug":return"aug"}}function ge(r){switch(r){case"maj7":return["Root","Major 3rd","Perfect 5th","Major 7th"];case"min7":return["Root","Minor 3rd","Perfect 5th","Minor 7th"];case"dom7":return["Root","Major 3rd","Perfect 5th","Minor 7th"];case"min7b5":return["Root","Minor 3rd","Diminished 5th","Minor 7th"];case"dim7":return["Root","Minor 3rd","Diminished 5th","Diminished 7th"];case"aug":return["Root","Major 3rd","Augmented 5th"]}}function pe(r,I,m,x){const F=r.map(h=>ne(h,I,m,x));let N=[],P=1/0;for(let h=0;h<=m-r.length;h++){const y=r.map((u,c)=>F[c].filter(g=>g.string===h+c));if(!y.some(u=>u.length===0))for(const u of y[0]){const c=[u];for(let i=1;i<y.length;i++){const C=y[i].reduce((o,M)=>Math.abs(M.fret-u.fret)<Math.abs(o.fret-u.fret)?M:o);c.push(C)}const g=c.map(i=>i.fret),n=Math.max(...g)-Math.min(...g);n<P&&(P=n,N=c)}}return N}const je=({exercise:r})=>{const{instrument:I,stringCount:m,tuning:x,fretCount:F,setHighlightedPositions:N,setSecondaryHighlightedPositions:P,setRootNote:h,clearHighlights:y}=se(),u=I==="guitar",{droneConfig:c,setDroneConfig:g,isDroneActive:n,setDroneActive:i}=oe(),{isActive:C}=re(),[o,M]=a.useState("C"),[p,z]=a.useState("maj7"),[$,X]=a.useState(!0),[L,_]=a.useState(!1),[S,K]=a.useState(-1),b=a.useRef([]);a.useEffect(()=>{const t=ue[r.id];t&&z(t)},[r.id]);const D=$?F:12,E=a.useMemo(()=>{const t=T(p),l=`${o}${t}`,s=R(l);if(!s||s.length===0)return[];const A=s.map(f=>Q(f));return pe(A,x,m,D)},[o,p,x,m,D]),O=a.useCallback(()=>{if(C)try{const t=T(p),l=`${o}${t}`,s=R(l);if(s&&s.length>0){const A=s.map(v=>Q(v)),f=Q(o);if(h(f),S>=0&&S<E.length){const v=E[S],j=E.filter((k,w)=>w!==S);N([v]),P(j)}else{const v=G([f],x,m,D),j=A.filter(w=>w!==f),k=G(j,x,m,D);N(k),P(v)}}}catch(t){console.error("Error computing arpeggio positions:",t)}},[o,p,$,C,S,m,x,D,E,N,P,h]);a.useEffect(()=>{O()},[O]),a.useEffect(()=>{n&&g({note:o,octave:2})},[o,n,g]),a.useEffect(()=>()=>{b.current.forEach(t=>clearTimeout(t)),b.current=[],y(),n&&(Y(),i(!1))},[y,n,i]);const J=async()=>{await B(),n?(Y(),i(!1)):(g({note:o,octave:2}),ie({note:o,octave:2,volume:c.volume,waveform:c.waveform}),i(!0))},V=async()=>{if(L)return;await B(),_(!0),b.current.forEach(A=>clearTimeout(A)),b.current=[];const t=T(p),l=`${o}${t}`,s=R(l);if(s&&s.length>0){const f=s.map(d=>`${d}2`),v=[...f].reverse().slice(1),j=[...f,...v],k=s.map((d,H)=>H),w=[...k].reverse().slice(1),ee=[...k,...w];for(let d=0;d<j.length;d++){ce(j[d],{duration:.5,velocity:.7,delay:d*.35});const H=setTimeout(()=>{K(ee[d])},d*.35*1e3);b.current.push(H)}const te=setTimeout(()=>{K(-1),_(!1),b.current=[]},j.length*.35*1e3+500);b.current.push(te)}else _(!1)},U=T(p),W=`${o}${U}`,Z=R(W),q=ge(p);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:o,onChange:t=>M(t.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:me.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Chord Quality"}),e.jsx("select",{value:p,onChange:t=>z(t.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:he.map(t=>e.jsxs("option",{value:t.value,children:[t.label," (",t.symbol,")"]},t.value))})]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsxs("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:[o,U," Arpeggio"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Z.map((t,l)=>{const s=S===l;return e.jsxs("div",{className:"flex flex-col items-center px-3 py-2 rounded-lg transition-all",style:{backgroundColor:s?"var(--accent-primary)":"var(--bg-primary)",border:`1px solid ${s?"var(--accent-primary)":"var(--border-color)"}`,color:s?"white":"var(--text-primary)",transform:s?"scale(1.1)":"scale(1)"},children:[e.jsx("span",{className:"text-sm font-bold",children:t}),e.jsx("span",{className:"text-xs",style:{opacity:.7},children:q[l]||""})]},l)})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-primary)"},children:[e.jsx("input",{type:"checkbox",checked:$,onChange:t=>X(t.target.checked),className:"rounded"}),"Full fretboard"]}),e.jsx(le,{})]}),e.jsx("div",{className:"card p-4",children:e.jsx(ae,{interactive:!0})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("button",{onClick:J,className:n?"btn-danger":"btn-success",children:n?"Stop Drone":"Play Drone"}),e.jsx("button",{onClick:V,disabled:L,className:"btn-secondary disabled:opacity-50",children:L?"Playing...":"Play Arpeggio"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Practice Tips"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",style:{color:"var(--text-secondary)"},children:[u?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"Practice sweep picking â€” use a continuous downstroke across strings ascending, upstroke descending"}),e.jsx("li",{children:"Start slowly with a metronome"}),e.jsx("li",{children:"Mute strings after playing to keep the arpeggio clean"}),e.jsx("li",{children:"Economy of motion: keep your pick close to the strings"}),e.jsx("li",{children:"Learn each inversion: start on the root, 3rd, 5th, and 7th"}),e.jsx("li",{children:"Practice connecting arpeggio shapes across positions on the neck"}),e.jsx("li",{children:"Over a chord progression, switch arpeggios to outline the harmony"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"Play the arpeggio ascending and descending with even tone"}),e.jsx("li",{children:"Use alternating fingers (index-middle) for consistent attack"}),e.jsx("li",{children:"Learn each inversion: start on the root, 3rd, 5th, and 7th"}),e.jsx("li",{children:"Practice connecting arpeggio shapes across positions on the neck"}),e.jsx("li",{children:"Over a chord progression, switch arpeggios to outline the harmony"}),r.id==="bass-arp-4"&&e.jsx("li",{children:"For inversions, start on each chord tone in turn: root position, 1st, 2nd, 3rd inversion"})]}),e.jsx("li",{children:"Use the drone to hear how each arpeggio tone relates to the root"})]})]}),e.jsx(de,{exerciseId:r.id,exerciseType:r.type})]})};export{je as default};
