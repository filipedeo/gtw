import{u as Q,c as V,d as W,r as u,l as D,n as X,s as O,j as e,F as Z,m as ee,g as A,i as L,f as te,p as se}from"./index-CqEMcS90.js";import{a as C}from"./theoryEngine-D3Rc5Crk.js";import{D as oe}from"./DisplayModeToggle-I1_i2FX6.js";import"./tone-BDbzsNEa.js";const ne=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],re=["Ionian (Major)","Dorian","Phrygian","Lydian","Mixolydian","Aeolian (Natural Minor)","Locrian"],ae=[5,0,1,2,4],ie=[0,1,2,4,5],le=["Root","b3","4","5","b7"],ce=["Root","2","3","5","6"];function F(l){return l.map(c=>D(c).chroma).filter(c=>c!==void 0)}function G(l){return ee(l)||l}function K(l,c,p,b,v){const y=C(l,c==="minor"?"minor pentatonic":"major pentatonic");if(!y||y.length===0)return[];const N=F(y),w=N[0],d=[];for(let t=0;t<=22;t++){const a=A({string:0,fret:t},b),n=D(a).chroma;n!==void 0&&N.includes(n)&&d.push({fret:t,chroma:n})}const x=d.findIndex(t=>t.chroma===w);if(x===-1)return[];const S=x+p;if(S>=d.length)return[];let o=d[S].fret;o>12&&(o-=12);const h=[];for(let t=0;t<v;t++){const a=[];for(let r=0;r<=22;r++){const i=A({string:t,fret:r},b),f=D(i).chroma;f!==void 0&&N.includes(f)&&a.push(r)}let n=[],m=1/0;for(let r=0;r<a.length-1;r++){const i=[a[r],a[r+1]];if(i[0]>=o-1&&i[1]<=o+4){const f=Math.abs(i[0]-o);f<m&&(m=f,n=i)}}if(n.length===0)for(let r=0;r<a.length-1;r++){const i=[a[r],a[r+1]];if(i[1]-i[0]<=5){const f=(i[0]+i[1])/2,P=Math.abs(f-(o+1.5));P<m&&(m=P,n=i)}}n.forEach(r=>h.push({string:t,fret:r}))}return h}function de(l,c,p,b,v){if(l.length===0)return[];const M=p==="minor"?"minor pentatonic":"major pentatonic",y=p==="minor"?"aeolian":"major",N=F(C(c,M)),d=F(C(c,y)).filter(t=>!N.includes(t));if(d.length===0)return[];const x=l.map(t=>t.fret),S=Math.min(...x),o=Math.max(...x),h=[];for(let t=0;t<v;t++)for(let a=Math.max(0,S-1);a<=o+1;a++){const n=A({string:t,fret:a},b),m=D(n).chroma;m!==void 0&&d.includes(m)&&h.push({string:t,fret:a})}return h}const pe=({exercise:l})=>{const{stringCount:c,tuning:p,setHighlightedPositions:b,setSecondaryHighlightedPositions:v,setRootNote:M,clearHighlights:y}=Q(),{droneConfig:N,setDroneConfig:w,isDroneActive:d,setDroneActive:x}=V(),{isActive:S}=W(),[o,h]=u.useState("A"),[t,a]=u.useState("minor"),[n,m]=u.useState(0),[r,i]=u.useState(!1),[f,P]=u.useState(!1);u.useEffect(()=>{l.id==="pentatonic-1"||l.id==="pentatonic-2"?(a("minor"),m(0),i(!1),h("A")):l.id==="pentatonic-3"?(a("major"),m(0),i(!1),h("C")):l.id==="pentatonic-4"&&(a("minor"),m(0),i(!0),h("A"))},[l.id]);const H=t==="minor"?ae:ie,J=t==="minor"?le:ce,_=re[H[n]],$=J[n],z=u.useCallback(()=>{const s=t==="minor"?"minor pentatonic":"major pentatonic",g=t==="minor"?"aeolian":"major",k=F(C(o,s));return C(o,g).filter(E=>{const B=D(E).chroma;return B!==void 0&&!k.includes(B)}).map(G)},[o,t]),U=u.useCallback(()=>{const g=C(o,t==="minor"?"minor pentatonic":"major pentatonic");return n<g.length?G(g[n]):o},[o,t,n]),R=u.useCallback(()=>{if(!S)return;const s=K(o,t,n,p,c);if(b(s),M(X(o)),r){const g=de(s,o,t,p,c);v(g)}else v([])},[S,o,t,n,r,p,c,b,v,M]);u.useEffect(()=>{R()},[R]),u.useEffect(()=>()=>{y(),d&&(O(),x(!1))},[y,d,x]);const Y=async()=>{await L(),d?(O(),x(!1)):(w({note:o,octave:2}),te({note:o,octave:2,volume:N.volume,waveform:N.waveform}),x(!0))},q=async()=>{if(f)return;await L(),P(!0);const g=[...K(o,t,n,p,c)].sort((j,E)=>j.string!==E.string?j.string-E.string:j.fret-E.fret),k=.25;for(let j=0;j<g.length;j++){const E=A(g[j],p);se(E,{duration:.4,velocity:.7,delay:j*k})}setTimeout(()=>P(!1),g.length*k*1e3+500)},I=z(),T=U();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Scale Type"}),e.jsx("div",{className:"flex gap-2",children:["minor","major"].map(s=>e.jsxs("button",{onClick:()=>a(s),className:`flex-1 py-2 rounded-lg font-medium transition-all ${t===s?"btn-primary":""}`,style:t!==s?{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"}:{},children:[s==="minor"?"Minor":"Major"," Pent."]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:o,onChange:s=>h(s.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:ne.map(s=>e.jsxs("option",{value:s,children:[s," ",t==="minor"?"Minor":"Major"," Pentatonic"]},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Shape / Box"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3,4].map(s=>e.jsx("button",{onClick:()=>m(s),className:`flex-1 py-2 rounded-lg font-bold transition-all ${n===s?"btn-primary":""}`,style:n!==s?{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"}:{},children:s+1},s))})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsxs("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:["Shape ",n+1," — ",o," ",t==="minor"?"Minor":"Major"," Pentatonic"]}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--text-secondary)"},children:[e.jsxs("p",{children:["Starts from the ",e.jsx("strong",{children:$})," (",T,") on the lowest string"]}),e.jsxs("p",{children:["Extends to: ",e.jsxs("strong",{children:[T," ",_]})," by adding ",I.join(" and ")]}),t==="minor"&&e.jsx("p",{className:"mt-1",style:{color:"var(--text-muted)"},children:"Minor pentatonic = 1 b3 4 5 b7 — missing the 2nd and 6th degrees"}),t==="major"&&e.jsx("p",{className:"mt-1",style:{color:"var(--text-muted)"},children:"Major pentatonic = 1 2 3 5 6 — missing the 4th and 7th degrees"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:s=>i(s.target.checked),className:"rounded"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:["Show Full Scale (+",I.join(", "),")"]})]}),e.jsx(oe,{})]}),e.jsx("div",{className:"card p-4",children:e.jsx(Z,{interactive:!0})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("button",{onClick:Y,className:d?"btn-danger":"btn-success",children:d?"Stop Drone":"Play Drone"}),e.jsx("button",{onClick:q,disabled:f,className:"btn-secondary disabled:opacity-50",children:f?"Playing...":"Play Scale"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Practice Tips"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",style:{color:"var(--text-secondary)"},children:[e.jsx("li",{children:"Master each shape individually before connecting them"}),e.jsx("li",{children:'Look for the "rectangle" — two adjacent strings where the minor 3rd intervals sit; the 2 extension notes always land here'}),e.jsx("li",{children:'Toggle "Show Full Scale" to see how adding 2 notes turns the pentatonic into a full mode'}),e.jsx("li",{children:"Try the same lick in all 5 shapes to build fretboard freedom"}),e.jsx("li",{children:"Each box connects to the next — the top notes of one box overlap with the bottom of the next"}),e.jsx("li",{children:"Use the drone to hear how pentatonic notes relate to the root"}),r&&e.jsxs("li",{children:["The faded notes (",I.join(" and "),") turn this shape into ",T," ",_]})]})]})]})};export{pe as default};
