import{u as X,r as n,i as Y,g as j,p as b,j as e,F as Z,b as _}from"./index-C8A4Ktcn.js";import{u as ee}from"./useExercise-CBmOFRiT.js";import{D as te}from"./DisplayModeToggle-DWUUreXa.js";import"./tone-BDbzsNEa.js";const P=[{name:"Minor 2nd",short:"m2",semitones:1,song:'"Jaws" theme'},{name:"Major 2nd",short:"M2",semitones:2,song:'"Happy Birthday" (first two notes)'},{name:"Minor 3rd",short:"m3",semitones:3,song:'"Greensleeves" (first two notes)'},{name:"Major 3rd",short:"M3",semitones:4,song:'"Kumbaya" (first two notes)'},{name:"Perfect 4th",short:"P4",semitones:5,song:'"Here Comes the Bride"'},{name:"Tritone",short:"TT",semitones:6,song:'"The Simpsons" theme'},{name:"Perfect 5th",short:"P5",semitones:7,song:'"Star Wars" theme'},{name:"Minor 6th",short:"m6",semitones:8,song:'"Love Story" (theme)'},{name:"Major 6th",short:"M6",semitones:9,song:'"My Bonnie Lies Over the Ocean"'},{name:"Minor 7th",short:"m7",semitones:10,song:'"Somewhere" (West Side Story)'},{name:"Major 7th",short:"M7",semitones:11,song:'"Superman Theme" (first two notes)'},{name:"Octave",short:"P8",semitones:12,song:'"Somewhere Over the Rainbow"'}];function se(a){return a<=1?P.filter(c=>["P4","P5"].includes(c.short)):a<=2?P.filter(c=>["m3","M3","P4","P5"].includes(c.short)):P}const ie=({exercise:a})=>{const{stringCount:c,tuning:h,setHighlightedPositions:k,clearHighlights:N}=X(),{score:f,questionNumber:O,isActive:i,recordAnswer:C,scorePercentage:L}=ee({exerciseId:a.id,totalQuestions:10}),[T,$]=n.useState(null),[A,H]=n.useState(null),[l,W]=n.useState(null),[x,B]=n.useState([]),[o,D]=n.useState(null),[y,I]=n.useState(null),[Q,R]=n.useState(!1),[q,G]=n.useState("ascending"),E=n.useRef(()=>{});n.useEffect(()=>{const t=r=>{if(!i||o!==null)return;const s={1:0,2:1,3:2,4:3};if(r.key in s){const m=s[r.key];m<x.length&&(r.preventDefault(),E.current(x[m].short))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[i,o,x]);const d=n.useMemo(()=>se(a.difficulty),[a.difficulty]),v=n.useCallback(async()=>{await Y();const t=d[Math.floor(Math.random()*d.length)],r=a.difficulty<=1?7:12,s=_(c,r,0),m=Math.random()>.5?"ascending":"descending",S=m==="ascending"?s.fret+t.semitones:s.fret-t.semitones;let g=S,p=m;(S<0||S>22)&&(p=m==="ascending"?"descending":"ascending",g=p==="ascending"?s.fret+t.semitones:s.fret-t.semitones);let u=s;(g<0||g>22)&&(u={...s,fret:Math.min(s.fret,10)},g=u.fret+t.semitones,p="ascending"),$(u);const M={string:u.string,fret:g},K=d.filter(z=>z.short!==t.short).sort(()=>Math.random()-.5).slice(0,3),J=[t,...K].sort(()=>Math.random()-.5);H(M),W(t),B(J),D(null),I(null),R(!1),G(p),k([u,M]);const U=j(u,h),V=j(M,h);setTimeout(()=>{b(U,{duration:.8,velocity:.7}),setTimeout(()=>b(V,{duration:.8,velocity:.7}),600)},300)},[c,h,a.difficulty,d,k]);n.useEffect(()=>(i?v():N(),()=>{N()}),[i,v,N]);const w=()=>{if(!T||!A)return;const t=j(T,h),r=j(A,h);b(t,{duration:.8,velocity:.7}),setTimeout(()=>b(r,{duration:.8,velocity:.7}),600)},F=n.useCallback(t=>{if(o!==null||!i||!l)return;D(t);const r=t===l.short;I(r),R(!0),C(r),w(),setTimeout(()=>{f.total+1<10&&v()},2500)},[o,i,l,f.total,C,w,v]);return E.current=F,i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Question ",O," of 10"]}),e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Score: ",f.correct,"/",f.total,f.total>0&&e.jsxs("span",{style:{color:"var(--text-muted)"},className:"ml-2",children:["(",L,"%)"]})]})]}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(te,{compact:!0})}),e.jsx("div",{className:"card p-4",children:e.jsx(Z,{interactive:!1})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--text-primary)"},children:"What interval is being played?"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["Direction: ",q==="ascending"?"â†‘ Ascending":"â†“ Descending"]}),e.jsx("button",{onClick:w,className:"btn-secondary text-sm flex items-center gap-1",disabled:o!==null,children:"ðŸ”Š Play Again"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-2xl mx-auto",role:"group","aria-label":"Answer options. Press 1, 2, 3, or 4 to select an answer",children:x.map((t,r)=>{let s={padding:"1rem",borderRadius:"0.5rem",fontWeight:"bold",transition:"all 0.2s",border:"none",cursor:o===null?"pointer":"default"};return o===null?(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-primary)"):t.short===l?.short?(s.backgroundColor="var(--success)",s.color="white"):t.short===o?(s.backgroundColor="var(--error)",s.color="white"):(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-muted)",s.opacity=.5),e.jsxs("button",{onClick:()=>F(t.short),disabled:o!==null,style:s,className:"hover:opacity-90 flex flex-col items-center focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":`Option ${r+1}: ${t.name}, ${t.semitones} semitones. Press ${r+1} to select`,"aria-pressed":o===t.short,children:[e.jsxs("span",{className:"sr-only",children:[r+1,": "]}),e.jsx("span",{className:"text-lg",children:t.short}),e.jsx("span",{className:"text-xs opacity-75",children:t.name})]},t.short)})}),e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{"aria-hidden":"true",children:"Tip: Press 1, 2, 3, or 4 to quickly select an answer"}),e.jsx("span",{className:"sr-only",children:"Use number keys 1 through 4 to select answers"})]}),Q&&l&&e.jsxs("div",{className:"text-center p-4 rounded-lg animate-fade-in",style:{backgroundColor:y?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)"},role:"alert","aria-live":"assertive",children:[e.jsxs("p",{className:"font-medium text-lg",style:{color:y?"var(--success)":"var(--error)"},children:[e.jsx("span",{"aria-hidden":"true",children:y?"âœ“":"âœ—"}),y?" Correct!":` Incorrect. The answer was ${l.name}`]}),e.jsxs("p",{className:"text-sm mt-2",style:{color:"var(--text-secondary)"},children:["Song reference: ",l.song]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Interval Reference"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm",children:d.map(t=>e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsxs("span",{style:{color:"var(--text-secondary)"},children:[e.jsx("strong",{children:t.short})," (",t.semitones,"st)"]}),e.jsx("span",{style:{color:"var(--text-muted)"},children:t.song})]},t.short))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{style:{color:"var(--text-secondary)"},className:"mb-4",children:'Click "Start Exercise" to begin interval recognition training.'}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm",style:{color:"var(--text-muted)"},children:[e.jsxs("span",{children:["Difficulty: ",a.difficulty,"/5"]}),e.jsx("span",{children:"|"}),e.jsxs("span",{children:["Intervals: ",d.map(t=>t.short).join(", ")]})]})]})};export{ie as default};
