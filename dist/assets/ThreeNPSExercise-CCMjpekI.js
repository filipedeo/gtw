import{u as z,c as O,d as U,r as m,n as C,s as A,j as e,F as Y,g as B,i as T,f as q,p as J}from"./index-Cay9Vtxh.js";import{M as P,g as L}from"./theoryEngine-DGNflXQT.js";import{D as Q}from"./DisplayModeToggle-BpAHNKn2.js";import{P as V}from"./PracticeRating-DPm74W8O.js";import"./tone-BWNjRQgH.js";const W=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"];function E(c,D,d,p,N){const g=L(C(c),D);if(!g||g.length===0)return[];const S=g.map(h=>C(h)),y=[];let f=N;for(let h=0;h<p;h++){const r=[];for(let t=0;t<=22;t++){const j=B({string:h,fret:t},d),o=C(j.replace(/\d/,""));S.includes(o)&&r.push(t)}let l=[],v=1/0;for(let t=0;t<=r.length-3;t++){const s=[r[t],r[t+1],r[t+2]];if(s[2]-s[0]<=5){const j=(s[0]+s[2])/2,o=Math.abs(j-f-2);o<v&&(v=o,l=s)}}l.length===3&&(l.forEach(t=>y.push({string:h,fret:t})),f=Math.max(f,l[0]))}return y}const te=({exercise:c})=>{const{instrument:D,stringCount:d,tuning:p,setHighlightedPositions:N,setSecondaryHighlightedPositions:g,setRootNote:S,clearHighlights:y}=z(),{droneConfig:f,setDroneConfig:h,isDroneActive:r,setDroneActive:l}=O(),{isActive:v}=U(),t=D==="bass",[s,j]=m.useState("C"),[o,F]=m.useState(0),[u,K]=m.useState(0),[M,k]=m.useState(!1);m.useEffect(()=>{const a={"three-nps-1":0,"three-nps-2":1,"three-nps-phrygian":2,"three-nps-lydian":3,"three-nps-mixolydian":4,"three-nps-aeolian":5,"three-nps-locrian":6,"three-nps-harmonic-minor":7,"three-nps-melodic-minor":8}[c.id];a!==void 0&&F(a)},[c.id]);const b=P[o],I=m.useCallback(()=>{if(!v)return;const n=E(s,b.name,p,d,u);if(N(n),S(C(s)),c.id==="three-nps-3"){const a=(o+1)%P.length,w=P[a],i=u+2,x=E(s,w.name,p,d,i);g(x)}else g([])},[v,s,b,o,p,d,u,c.id,N,g,S]);m.useEffect(()=>{I()},[I]),m.useEffect(()=>()=>{y(),r&&(A(),l(!1))},[y,r,l]);const R=async()=>{await T(),r?(A(),l(!1)):(h({note:s,octave:2}),q({note:s,octave:2,volume:f.volume,waveform:f.waveform}),l(!0))},G=async()=>{if(M)return;await T(),k(!0);const a=[...E(s,b.name,p,d,u)].sort((i,x)=>i.string!==x.string?i.string-x.string:i.fret-x.fret),w=.2;for(let i=0;i<a.length;i++){const x=a[i],H=B(x,p);J(H,{duration:.4,velocity:.7,delay:i*w})}setTimeout(()=>{k(!1)},a.length*w*1e3+500)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Mode / Pattern"}),e.jsx("select",{value:o,onChange:n=>F(parseInt(n.target.value)),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:P.map((n,a)=>e.jsxs("option",{value:a,children:["Pattern ",a+1," - ",n.displayName]},n.name))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:s,onChange:n=>j(n.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:W.map(n=>e.jsx("option",{value:n,children:n},n))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:["Starting Fret Position: ",u]}),e.jsx("input",{type:"range",min:0,max:12,value:u,onChange:n=>K(parseInt(n.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{children:"Open"}),e.jsx("span",{children:"12th Fret"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsxs("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:["Pattern ",o+1," - ",b.displayName," (",s,")"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Characteristic note: ",e.jsx("strong",{children:b.characteristicNote})," ","—"," ","3 notes per string starting near fret ",u,".",d>=5&&t?" Includes low B string.":d===7?" Includes low B string for 7-string coverage.":""]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(Q,{})}),e.jsx("div",{className:"card p-4",children:e.jsx(Y,{interactive:!0})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("button",{onClick:R,className:r?"btn-danger":"btn-success",children:r?"Stop Drone":"Play Drone"}),e.jsx("button",{onClick:G,disabled:M,className:"btn-secondary disabled:opacity-50",children:M?"Playing...":"Play Scale"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Practice Tips"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",style:{color:"var(--text-secondary)"},children:[e.jsxs("li",{children:["Every string gets exactly 3 notes — great for even ",t?"finger alternation":"alternate picking"]}),e.jsx("li",{children:"All 7 patterns use just 3 finger shapes: whole-whole (1-3-5), whole-half (1-3-4), and half-whole (1-2-4)"}),e.jsxs("li",{children:["Practice ascending and descending with strict ",t?"alternating fingers (index-middle)":"alternate picking"]}),e.jsx("li",{children:"Try legato (hammer-ons ascending, pull-offs descending) for smooth lines"}),e.jsx("li",{children:"Start slow with a metronome — increase speed only when clean"}),t&&e.jsx("li",{children:"Focus on consistent right-hand finger alternation (index-middle) for an even tone across all strings"}),e.jsx("li",{children:"Use the drone to hear how each note relates to the tonal center"}),e.jsx("li",{children:"Connect adjacent patterns by sliding between them"}),e.jsx("li",{children:"Remove the highest and lowest note per string to reveal the pentatonic shape hiding inside each 3NPS pattern"})]})]}),e.jsx(V,{exerciseId:c.id,exerciseType:c.type})]})};export{te as default,E as getThreeNPSPositions};
