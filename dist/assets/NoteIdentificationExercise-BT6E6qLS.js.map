{"version":3,"file":"NoteIdentificationExercise-BT6E6qLS.js","sources":["../../src/components/NoteIdentificationExercise.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { Exercise } from '../types/exercise';\nimport { FretPosition, NOTE_NAMES, normalizeNoteName, areNotesEqual } from '../types/guitar';\nimport { useGuitarStore } from '../stores/guitarStore';\nimport { useExercise } from '../hooks/useExercise';\nimport { getNoteAtPosition, getRandomPosition } from '../utils/fretboardCalculations';\nimport { playNote, initAudio } from '../lib/audioEngine';\nimport Fretboard from './Fretboard';\n\ninterface NoteIdentificationExerciseProps {\n  exercise: Exercise;\n}\n\nconst NoteIdentificationExercise: React.FC<NoteIdentificationExerciseProps> = ({ exercise }) => {\n  const { stringCount, tuning, setHighlightedPositions, setRootNote, clearHighlights } = useGuitarStore();\n  const { score, questionNumber, isActive, recordAnswer, scorePercentage } = useExercise({\n    exerciseId: exercise.id,\n    totalQuestions: 10,\n  });\n  \n  const [currentPosition, setCurrentPosition] = useState<FretPosition | null>(null);\n  const [correctNote, setCorrectNote] = useState<string>('');\n  const [fullNote, setFullNote] = useState<string>('');\n  const [options, setOptions] = useState<string[]>([]);\n  const [selectedAnswer, setSelectedAnswer] = useState<string | null>(null);\n  const [isCorrect, setIsCorrect] = useState<boolean | null>(null);\n  const [showFeedback, setShowFeedback] = useState(false);\n  const [revealedPositions, setRevealedPositions] = useState<FretPosition[]>([]);\n\n  // Keyboard shortcut handler for answer selection (1, 2, 3, 4 keys)\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isActive || selectedAnswer !== null) return;\n      \n      const keyMap: { [key: string]: number } = {\n        '1': 0,\n        '2': 1,\n        '3': 2,\n        '4': 3,\n      };\n      \n      if (e.key in keyMap) {\n        const index = keyMap[e.key];\n        if (index < options.length) {\n          e.preventDefault();\n          handleAnswer(options[index]);\n        }\n      }\n    };\n    \n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isActive, selectedAnswer, options]);\n\n  // Determine max fret based on difficulty\n  const maxFret = exercise.difficulty <= 1 ? 5 : exercise.difficulty <= 2 ? 12 : 22;\n\n  const generateQuestion = useCallback(async () => {\n    // Ensure audio is ready\n    await initAudio();\n    \n    // Generate random position\n    const position = getRandomPosition(stringCount, maxFret, 0);\n    const note = getNoteAtPosition(position, tuning, stringCount);\n    const rawNoteName = note.replace(/\\d/, ''); // Remove octave number\n    \n    // Normalize the note name to use sharps (handles enharmonic equivalents)\n    const noteName = normalizeNoteName(rawNoteName);\n    \n    // Generate options (correct + 3 wrong)\n    // Use areNotesEqual to properly filter out enharmonic equivalents\n    const wrongOptions = NOTE_NAMES\n      .filter(n => !areNotesEqual(n, noteName))\n      .sort(() => Math.random() - 0.5)\n      .slice(0, 3);\n    \n    const allOptions = [noteName, ...wrongOptions].sort(() => Math.random() - 0.5);\n    \n    setCurrentPosition(position);\n    setCorrectNote(noteName);\n    setFullNote(note);\n    setOptions(allOptions);\n    setSelectedAnswer(null);\n    setIsCorrect(null);\n    setShowFeedback(false);\n    setRevealedPositions([]); // Hide note name until answered\n    \n    // Highlight the position on fretboard\n    setHighlightedPositions([position]);\n    setRootNote(null);\n    \n    // Play the note so user can hear it\n    setTimeout(() => {\n      playNote(note, { duration: 1.5, velocity: 0.7 });\n    }, 300);\n    \n  }, [stringCount, tuning, maxFret, setHighlightedPositions, setRootNote]);\n\n  // Generate first question when exercise starts\n  useEffect(() => {\n    if (isActive) {\n      generateQuestion();\n    } else {\n      clearHighlights();\n      setRevealedPositions([]);\n    }\n    \n    return () => {\n      clearHighlights();\n      setRevealedPositions([]);\n    };\n  }, [isActive, generateQuestion, clearHighlights]);\n\n  const handlePlayAgain = () => {\n    if (fullNote) {\n      playNote(fullNote, { duration: 1.5, velocity: 0.7 });\n    }\n  };\n\n  const handleAnswer = (answer: string) => {\n    if (selectedAnswer !== null || !isActive || !currentPosition) return;\n    \n    setSelectedAnswer(answer);\n    // Use enharmonic-aware comparison\n    const correct = areNotesEqual(answer, correctNote);\n    setIsCorrect(correct);\n    setShowFeedback(true);\n    \n    // Reveal the note on the fretboard\n    setRevealedPositions([currentPosition]);\n    \n    // Record answer using the hook (handles scoring, completion, and progress tracking)\n    recordAnswer(correct);\n    \n    // Play the note again to reinforce\n    playNote(fullNote, { duration: 1, velocity: 0.6 });\n    \n    // Move to next question after delay (hook handles completion check)\n    setTimeout(() => {\n      if (score.total + 1 < 10) {\n        generateQuestion();\n      }\n    }, 2000);\n  };\n\n  if (!isActive) {\n    return (\n      <div className=\"text-center py-8\">\n        <p style={{ color: 'var(--text-secondary)' }} className=\"mb-4\">\n          Click \"Start Exercise\" to begin identifying notes on the fretboard.\n        </p>\n        <div className=\"flex justify-center gap-4 text-sm\" style={{ color: 'var(--text-muted)' }}>\n          <span>Difficulty: {exercise.difficulty}/5</span>\n          <span>|</span>\n          <span>Frets: 0-{maxFret}</span>\n          <span>|</span>\n          <span>10 questions</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Score Display */}\n      <div className=\"flex justify-between items-center\">\n        <div className=\"text-sm\" style={{ color: 'var(--text-secondary)' }}>\n          Question {questionNumber} of 10\n        </div>\n        <div className=\"text-sm font-medium\" style={{ color: 'var(--text-primary)' }}>\n          Score: {score.correct}/{score.total}\n          {score.total > 0 && (\n            <span style={{ color: 'var(--text-muted)' }} className=\"ml-2\">\n              ({scorePercentage}%)\n            </span>\n          )}\n        </div>\n      </div>\n\n      {/* Embedded Fretboard for this exercise */}\n      <div className=\"card p-4\">\n        <Fretboard \n          interactive={false}\n          hideNoteNames={true}\n          revealedPositions={revealedPositions}\n        />\n      </div>\n\n      {/* Question */}\n      <div className=\"text-center\">\n        <p className=\"text-lg font-medium mb-2\" style={{ color: 'var(--text-primary)' }}>\n          What note is highlighted on the fretboard?\n        </p>\n        <div className=\"flex items-center justify-center gap-4\">\n          {currentPosition && (\n            <p className=\"text-sm\" style={{ color: 'var(--text-muted)' }}>\n              String {currentPosition.string + 1}, Fret {currentPosition.fret}\n            </p>\n          )}\n          <button\n            onClick={handlePlayAgain}\n            className=\"btn-secondary text-sm flex items-center gap-1\"\n            disabled={selectedAnswer !== null}\n          >\n            ðŸ”Š Play Again\n          </button>\n        </div>\n      </div>\n\n      {/* Answer Options */}\n      <div \n        className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-2xl mx-auto\"\n        role=\"group\"\n        aria-label=\"Answer options. Press 1, 2, 3, or 4 to select an answer\"\n      >\n        {options.map((option, index) => {\n          let buttonStyle: React.CSSProperties = {\n            padding: '1rem 1.5rem',\n            borderRadius: '0.5rem',\n            fontWeight: 'bold',\n            fontSize: '1.125rem',\n            transition: 'all 0.2s',\n            border: 'none',\n            cursor: selectedAnswer === null ? 'pointer' : 'default',\n          };\n          \n          if (selectedAnswer === null) {\n            buttonStyle.backgroundColor = 'var(--bg-tertiary)';\n            buttonStyle.color = 'var(--text-primary)';\n          } else if (option === correctNote) {\n            buttonStyle.backgroundColor = 'var(--success)';\n            buttonStyle.color = 'white';\n          } else if (option === selectedAnswer) {\n            buttonStyle.backgroundColor = 'var(--error)';\n            buttonStyle.color = 'white';\n          } else {\n            buttonStyle.backgroundColor = 'var(--bg-tertiary)';\n            buttonStyle.color = 'var(--text-muted)';\n            buttonStyle.opacity = 0.5;\n          }\n          \n          return (\n            <button\n              key={option}\n              onClick={() => handleAnswer(option)}\n              disabled={selectedAnswer !== null}\n              style={buttonStyle}\n              className=\"hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500\"\n              aria-label={`Option ${index + 1}: ${option}. Press ${index + 1} to select`}\n              aria-pressed={selectedAnswer === option}\n            >\n              <span className=\"sr-only\">{index + 1}: </span>\n              {option}\n            </button>\n          );\n        })}\n      </div>\n      {/* Keyboard hint */}\n      <p className=\"text-center text-xs\" style={{ color: 'var(--text-muted)' }}>\n        <span aria-hidden=\"true\">Tip: Press 1, 2, 3, or 4 to quickly select an answer</span>\n        <span className=\"sr-only\">Use number keys 1 through 4 to select answers</span>\n      </p>\n\n      {/* Feedback */}\n      {showFeedback && (\n        <div \n          className=\"text-center p-4 rounded-lg animate-fade-in\"\n          style={{ \n            backgroundColor: isCorrect ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',\n          }}\n          role=\"alert\"\n          aria-live=\"assertive\"\n        >\n          <p \n            className=\"font-medium text-lg\"\n            style={{ color: isCorrect ? 'var(--success)' : 'var(--error)' }}\n          >\n            <span aria-hidden=\"true\">{isCorrect ? 'âœ“' : 'âœ—'}</span>\n            {isCorrect ? ' Correct!' : ` Incorrect. The answer was ${correctNote}`}\n          </p>\n          <p className=\"text-sm mt-1\" style={{ color: 'var(--text-muted)' }}>\n            {fullNote} - String {currentPosition ? currentPosition.string + 1 : ''}, Fret {currentPosition?.fret}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default NoteIdentificationExercise;"],"names":["NoteIdentificationExercise","exercise","stringCount","tuning","setHighlightedPositions","setRootNote","clearHighlights","useGuitarStore","score","questionNumber","isActive","recordAnswer","scorePercentage","useExercise","currentPosition","setCurrentPosition","useState","correctNote","setCorrectNote","fullNote","setFullNote","options","setOptions","selectedAnswer","setSelectedAnswer","isCorrect","setIsCorrect","showFeedback","setShowFeedback","revealedPositions","setRevealedPositions","useEffect","handleKeyDown","e","keyMap","index","handleAnswer","maxFret","generateQuestion","useCallback","initAudio","position","getRandomPosition","note","getNoteAtPosition","rawNoteName","noteName","normalizeNoteName","wrongOptions","NOTE_NAMES","areNotesEqual","n","allOptions","playNote","handlePlayAgain","answer","correct","jsxs","jsx","Fretboard","option","buttonStyle"],"mappings":"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"}