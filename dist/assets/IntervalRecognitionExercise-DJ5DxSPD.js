import{u as Y,r,i as Z,k as _,g as b,p as j,j as e,F as ee,b as te}from"./index-CWkcNJvv.js";import{u as se}from"./useExercise-Cph0nCK6.js";import{D as re}from"./DisplayModeToggle-CFeXEIgS.js";import"./tone-BWNjRQgH.js";const S=[{name:"Minor 2nd",short:"m2",semitones:1,song:'"Jaws" theme'},{name:"Major 2nd",short:"M2",semitones:2,song:'"Happy Birthday" (first two notes)'},{name:"Minor 3rd",short:"m3",semitones:3,song:'"Greensleeves" (first two notes)'},{name:"Major 3rd",short:"M3",semitones:4,song:'"Kumbaya" (first two notes)'},{name:"Perfect 4th",short:"P4",semitones:5,song:'"Here Comes the Bride"'},{name:"Tritone",short:"TT",semitones:6,song:'"The Simpsons" theme'},{name:"Perfect 5th",short:"P5",semitones:7,song:'"Star Wars" theme'},{name:"Minor 6th",short:"m6",semitones:8,song:'"Love Story" (theme)'},{name:"Major 6th",short:"M6",semitones:9,song:'"My Bonnie Lies Over the Ocean"'},{name:"Minor 7th",short:"m7",semitones:10,song:'"Somewhere" (West Side Story)'},{name:"Major 7th",short:"M7",semitones:11,song:'"Superman Theme" (first two notes)'},{name:"Octave",short:"P8",semitones:12,song:'"Somewhere Over the Rainbow"'}];function oe(a){return a<=1?S.filter(l=>["P4","P5"].includes(l.short)):a<=2?S.filter(l=>["m3","M3","P4","P5"].includes(l.short)):S}const ce=({exercise:a})=>{const{stringCount:l,tuning:u,setHighlightedPositions:k,clearHighlights:N}=Y(),{score:h,questionNumber:L,isActive:c,recordAnswer:C,scorePercentage:$}=se({exerciseId:a.id,exerciseType:a.type,totalQuestions:10}),[T,H]=r.useState(null),[A,Q]=r.useState(null),[i,W]=r.useState(null),[x,B]=r.useState([]),[n,R]=r.useState(null),[y,D]=r.useState(null),[q,I]=r.useState(!1),[G,K]=r.useState("ascending"),E=r.useRef(()=>{});r.useEffect(()=>{const t=o=>{if(!c||n!==null)return;const s={1:0,2:1,3:2,4:3};if(o.key in s){const d=s[o.key];d<x.length&&(o.preventDefault(),E.current(x[d].short))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[c,n,x]);const g=r.useMemo(()=>oe(a.difficulty),[a.difficulty]),v=r.useCallback(async()=>{await Z(),_();const t=g[Math.floor(Math.random()*g.length)],o=a.difficulty<=1?7:12,s=te(l,o,0),d=Math.random()>.5?"ascending":"descending",M=d==="ascending"?s.fret+t.semitones:s.fret-t.semitones;let f=M,p=d;(M<0||M>22)&&(p=d==="ascending"?"descending":"ascending",f=p==="ascending"?s.fret+t.semitones:s.fret-t.semitones);let m=s;(f<0||f>22)&&(m={...s,fret:Math.min(s.fret,10)},f=m.fret+t.semitones,p="ascending"),H(m);const P={string:m.string,fret:f},J=g.filter(X=>X.short!==t.short).sort(()=>Math.random()-.5).slice(0,3),U=[t,...J].sort(()=>Math.random()-.5);Q(P),W(t),B(U),R(null),D(null),I(!1),K(p),k([m,P]);const V=b(m,u),z=b(P,u);setTimeout(()=>{j(V,{duration:.8,velocity:.7}),setTimeout(()=>j(z,{duration:.8,velocity:.7}),600)},300)},[l,u,a.difficulty,g,k]),F=r.useRef(v);F.current=v,r.useEffect(()=>(c?F.current():N(),()=>{N()}),[c,N]);const w=()=>{if(!T||!A)return;const t=b(T,u),o=b(A,u);j(t,{duration:.8,velocity:.7}),setTimeout(()=>j(o,{duration:.8,velocity:.7}),600)},O=r.useCallback(t=>{if(n!==null||!c||!i)return;R(t);const o=t===i.short;D(o),I(!0),C(o),w(),setTimeout(()=>{h.total+1<10&&v()},2500)},[n,c,i,h.total,C,w,v]);return E.current=O,e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Question ",L," of 10"]}),e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Score: ",h.correct,"/",h.total,h.total>0&&e.jsxs("span",{style:{color:"var(--text-muted)"},className:"ml-2",children:["(",$,"%)"]})]})]}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(re,{compact:!0})}),e.jsx("div",{className:"card p-4",children:e.jsx(ee,{interactive:!1})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--text-primary)"},children:"What interval is being played?"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["Direction: ",G==="ascending"?"â†‘ Ascending":"â†“ Descending"]}),e.jsx("button",{onClick:w,className:"btn-secondary text-sm flex items-center gap-1",disabled:n!==null,children:"ðŸ”Š Play Again"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-2xl mx-auto",role:"group","aria-label":"Answer options. Press 1, 2, 3, or 4 to select an answer",children:x.map((t,o)=>{let s={padding:"1rem",borderRadius:"0.5rem",fontWeight:"bold",transition:"all 0.2s",border:"none",cursor:n===null?"pointer":"default"};return n===null?(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-primary)"):t.short===i?.short?(s.backgroundColor="var(--success)",s.color="white"):t.short===n?(s.backgroundColor="var(--error)",s.color="white"):(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-muted)",s.opacity=.5),e.jsxs("button",{onClick:()=>O(t.short),disabled:n!==null,style:s,className:"hover:opacity-90 flex flex-col items-center focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":`Option ${o+1}: ${t.name}, ${t.semitones} semitones. Press ${o+1} to select`,"aria-pressed":n===t.short,children:[e.jsxs("span",{className:"sr-only",children:[o+1,": "]}),e.jsx("span",{className:"text-lg",children:t.short}),e.jsx("span",{className:"text-xs opacity-75",children:t.name})]},t.short)})}),e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{"aria-hidden":"true",children:"Tip: Press 1, 2, 3, or 4 to quickly select an answer"}),e.jsx("span",{className:"sr-only",children:"Use number keys 1 through 4 to select answers"})]}),q&&i&&e.jsxs("div",{className:"text-center p-4 rounded-lg animate-fade-in",style:{backgroundColor:y?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)"},role:"alert","aria-live":"assertive",children:[e.jsxs("p",{className:"font-medium text-lg",style:{color:y?"var(--success)":"var(--error)"},children:[e.jsx("span",{"aria-hidden":"true",children:y?"âœ“":"âœ—"}),y?" Correct!":` Incorrect. The answer was ${i.name}`]}),e.jsxs("p",{className:"text-sm mt-2",style:{color:"var(--text-secondary)"},children:["Song reference: ",i.song]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Interval Reference"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm",children:g.map(t=>e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsxs("span",{style:{color:"var(--text-secondary)"},children:[e.jsx("strong",{children:t.short})," (",t.semitones,"st)"]}),e.jsx("span",{style:{color:"var(--text-muted)"},children:t.song})]},t.short))})]})]})};export{ce as default};
