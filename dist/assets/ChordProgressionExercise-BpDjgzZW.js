import{r as n,p as q,h as J,i as M,k as U,j as e}from"./index-C0VeEZru.js";import{u as W}from"./useExercise-a7q9m-LG.js";import{b as Y}from"./theoryEngine-DgM5JD7I.js";import"./tone-BDbzsNEa.js";const C=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],$=["C","D","E","F","G","A","Bb"],H=[{numerals:["I","IV","V","I"],degrees:[1,4,5,1],name:"Classic Cadence"},{numerals:["I","V","IV","I"],degrees:[1,5,4,1]},{numerals:["I","IV","I","V"],degrees:[1,4,1,5]},{numerals:["V","IV","I"],degrees:[5,4,1],name:"Rock Cadence"},{numerals:["I","V","I"],degrees:[1,5,1]},{numerals:["I","IV","V"],degrees:[1,4,5]}],X=[{numerals:["I","V","vi","IV"],degrees:[1,5,6,4],name:"Axis of Awesome"},{numerals:["I","vi","IV","V"],degrees:[1,6,4,5],name:"50s Progression"},{numerals:["vi","IV","I","V"],degrees:[6,4,1,5]},{numerals:["I","IV","vi","V"],degrees:[1,4,6,5]},{numerals:["vi","V","IV","V"],degrees:[6,5,4,5]},{numerals:["I","vi","ii","V"],degrees:[1,6,2,5]},{numerals:["ii","V","I"],degrees:[2,5,1],name:"Jazz ii-V-I"}],Z=[{numerals:["ii","V","I"],degrees:[2,5,1],name:"Jazz ii-V-I"},{numerals:["I","bVII","IV"],degrees:[1,"b7",4],name:"Mixolydian Vamp"},{numerals:["iii","vi","ii","V"],degrees:[3,6,2,5],name:"Circle of Fourths"},{numerals:["I","IV","bVII","IV"],degrees:[1,4,"b7",4]},{numerals:["vi","bVII","I"],degrees:[6,"b7",1],name:"Aeolian Cadence"},{numerals:["I","iii","IV","iv"],degrees:[1,3,4,"4m"],name:"Creep Progression"},{numerals:["I","vi","ii","V"],degrees:[1,6,2,5],name:"Rhythm Changes"}];function ee(i,a){let u=C.indexOf(i);u===-1&&(u=0);const c=3;return a.map(h=>{const j=(u+h)%12,w=c+Math.floor((u+h)/12);return`${C[j]}${w}`})}function se(i){let a=C.indexOf(i);return a===-1&&(a=0),`${C[a]}2`}function V(i){return i.join(" - ")}const ae=({exercise:i})=>{const{score:a,questionNumber:u,isActive:c,recordAnswer:h,scorePercentage:j}=W({exerciseId:i.id,totalQuestions:10}),[w,L]=n.useState("C"),[y,F]=n.useState(""),[p,G]=n.useState([]),[l,S]=n.useState(null),[f,A]=n.useState(null),[B,P]=n.useState(!1),[K,_]=n.useState([]),[E,z]=n.useState(null),R=n.useRef(()=>{}),g=i.id==="chord-prog-1"?H:i.id==="chord-prog-2"?X:Z;n.useEffect(()=>{const s=r=>{if(!c||l!==null)return;const t={1:0,2:1,3:2,4:3};if(r.key in t){const m=t[r.key];m<p.length&&(r.preventDefault(),R.current(p[m]))}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[c,l,p]);const N=n.useCallback(s=>{s.forEach((d,I)=>{const b=.3+I*1.3499999999999999;q(d.bass,{duration:1.2,velocity:.45,delay:b-.02}),J(d.notes,{duration:1.2,velocity:.55,delay:b})})},[]),v=n.useCallback(async()=>{await M(),U();const s=$[Math.floor(Math.random()*$.length)];L(s);const r=g[Math.floor(Math.random()*g.length)];z(r);const m=Y(s,r.degrees).map(o=>({bass:se(o.root),notes:ee(o.root,o.intervals)}));_(m);const d=V(r.numerals);F(d);const I=r.numerals.length,b=g.filter(o=>o.numerals.length===I&&V(o.numerals)!==d),Q=g.filter(o=>o.numerals.length!==I&&V(o.numerals)!==d),k=o=>[...o].sort(()=>Math.random()-.5);let x=k(b).slice(0,3);x.length<3&&(x=[...x,...k(Q).slice(0,3-x.length)]);const T=k([d,...x.map(o=>V(o.numerals))]);G(T),S(null),A(null),P(!1),N(m)},[g,N]);n.useEffect(()=>{c&&v()},[c,v]);const D=async()=>{await M(),N(K)},O=n.useCallback(s=>{if(l!==null||!c)return;S(s);const r=s===y;A(r),P(!0),h(r),D(),setTimeout(()=>{a.total+1<10&&v()},2500)},[l,c,y,a.total,h,v]);return R.current=O,c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Question ",u," of 10"]}),e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Score: ",a.correct,"/",a.total,a.total>0&&e.jsxs("span",{style:{color:"var(--text-muted)"},className:"ml-2",children:["(",j,"%)"]})]})]}),e.jsxs("div",{className:"p-8 rounded-lg text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽµ"}),e.jsx("p",{className:"text-lg font-medium",style:{color:"var(--text-primary)"},children:"What chord progression is this?"}),e.jsx("button",{onClick:D,className:"btn-secondary mt-4 flex items-center gap-2 mx-auto",disabled:l!==null,children:"ðŸ”Š Play Again"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-md mx-auto",role:"group","aria-label":"Answer options. Press number keys 1 through 4 to select an answer",children:p.map((s,r)=>{let t={padding:"1rem",borderRadius:"0.5rem",fontWeight:"bold",transition:"all 0.2s",border:"none",cursor:l===null?"pointer":"default"};return l===null?(t.backgroundColor="var(--bg-tertiary)",t.color="var(--text-primary)"):s===y?(t.backgroundColor="var(--success)",t.color="white"):s===l?(t.backgroundColor="var(--error)",t.color="white"):(t.backgroundColor="var(--bg-tertiary)",t.color="var(--text-muted)",t.opacity=.5),e.jsxs("button",{onClick:()=>O(s),disabled:l!==null,style:t,className:"hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":`Option ${r+1}: ${s}. Press ${r+1} to select`,"aria-pressed":l===s,children:[e.jsxs("span",{className:"sr-only",children:[r+1,": "]}),s]},s)})}),e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{"aria-hidden":"true",children:"Tip: Press number keys to quickly select an answer"}),e.jsx("span",{className:"sr-only",children:"Use number keys 1 through 4 to select answers"})]}),B&&e.jsxs("div",{className:"text-center p-4 rounded-lg animate-fade-in",style:{backgroundColor:f?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)"},role:"alert","aria-live":"assertive",children:[e.jsxs("p",{className:"font-medium text-lg",style:{color:f?"var(--success)":"var(--error)"},children:[e.jsx("span",{"aria-hidden":"true",children:f?"âœ“":"âœ—"}),f?" Correct!":` Incorrect. The answer was ${y}`]}),e.jsxs("p",{className:"text-sm mt-2",style:{color:"var(--text-secondary)"},children:["In the key of ",w," major",E?.name&&` â€” "${E.name}"`]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Quick Reference"}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--text-secondary)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Uppercase (I, IV, V):"})," Major chords â€” bright sound"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Lowercase (ii, iii, vi):"})," Minor chords â€” darker sound"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Bass movement:"})," Listen to the lowest note stepping between chords"]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{style:{color:"var(--text-secondary)"},className:"mb-4",children:'Click "Start Exercise" to begin chord progression training.'}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Listen to chord progressions and identify them by their Roman numerals."})]})};export{ae as default};
