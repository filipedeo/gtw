import{r as n,i as q,k as Y,h as y,p as L,j as e}from"./index-CrYEXAxW.js";import{u as J}from"./useExercise-DtxG2J82.js";import"./tone-BWNjRQgH.js";const b=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],j=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],w={basic:[{name:"Major",intervals:[0,4,7],description:"Bright, happy"},{name:"Minor",intervals:[0,3,7],description:"Dark, sad"}],seventh:[{name:"Major 7th",intervals:[0,4,7,11],description:"Dreamy, jazzy"},{name:"Minor 7th",intervals:[0,3,7,10],description:"Mellow, smooth"},{name:"Dominant 7th",intervals:[0,4,7,10],description:"Tense, wants to resolve"}]},Q=["1","2","3","4","5","6","7"],ee=({exercise:c})=>{const{score:m,questionNumber:B,isActive:i,recordAnswer:E,scorePercentage:H}=J({exerciseId:c.id,exerciseType:c.type,totalQuestions:10}),[a,k]=n.useState("chord-basic"),[K,G]=n.useState("C"),[d,C]=n.useState(""),[u,N]=n.useState([]),[l,D]=n.useState(null),[v,I]=n.useState(null),[_,T]=n.useState(!1),[F,M]=n.useState([]),[z,U]=n.useState(""),$=n.useRef(()=>{});n.useEffect(()=>{const t=r=>{if(!i||l!==null)return;const s={1:0,2:1,3:2,4:3,5:4,6:5,7:6};if(r.key in s){const o=s[r.key];o<u.length&&(r.preventDefault(),$.current(u[o]))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[i,l,u]),n.useEffect(()=>{c.id.includes("ear-1")?k("chord-basic"):c.id.includes("ear-2")?k("chord-seventh"):c.id.includes("ear-3")&&k("scale-degree")},[c.id]);const p=n.useCallback((t,r)=>{const s=t.replace(/\d/,"");let o=j.indexOf(s);o===-1&&(o=b.indexOf(s));const h=3;return r.map(g=>{const x=(o+g)%12,A=h+Math.floor((o+g)/12);return`${j[x]}${A}`})},[]),f=n.useCallback(async()=>{await q(),Y();const t=b[Math.floor(Math.random()*b.length)];if(G(t),a==="chord-basic"){const r=w.basic,s=r[Math.floor(Math.random()*r.length)],o=p(t,s.intervals);C(s.name),N(r.map(h=>h.name).sort(()=>Math.random()-.5)),M(o),setTimeout(()=>y(o,{duration:2,velocity:.6}),300)}else if(a==="chord-seventh"){const r=w.seventh,s=r[Math.floor(Math.random()*r.length)],o=p(t,s.intervals);C(s.name),N(r.map(h=>h.name).sort(()=>Math.random()-.5)),M(o),setTimeout(()=>y(o,{duration:2,velocity:.6}),300)}else if(a==="scale-degree"){const r=p(t,[0,4,7]),s=Math.floor(Math.random()*7),o=Q[s],g=[0,2,4,5,7,9,11][s];let x=j.indexOf(t);x===-1&&(x=b.indexOf(t));const A=(x+g)%12,P=`${j[A]}4`;C(o),N([...Q].sort(()=>Math.random()-.5)),M(r),U(P),setTimeout(()=>{y(r,{duration:1.5,velocity:.5}),setTimeout(()=>L(P,{duration:1.5,velocity:.7}),1800)},300)}D(null),I(null),T(!1)},[a,p]);n.useEffect(()=>{i&&f()},[i,f]);const S=async()=>{await q(),a==="scale-degree"?(y(F,{duration:1.5,velocity:.5}),setTimeout(()=>L(z,{duration:1.5,velocity:.7}),1800)):y(F,{duration:2,velocity:.6})},O=n.useCallback(t=>{if(l!==null||!i)return;D(t);const r=t===d;I(r),T(!0),E(r),S(),setTimeout(()=>{m.total+1<10&&f()},2500)},[l,i,d,m.total,E,S,f]);$.current=O;const W=()=>{switch(a){case"chord-basic":return"Is this chord Major or Minor?";case"chord-seventh":return"What type of 7th chord is this?";case"scale-degree":return`In the key of ${K}, what scale degree is this note?`;default:return"Listen and identify:"}},R=()=>a==="chord-basic"?w.basic.find(t=>t.name===d)?.description:a==="chord-seventh"?w.seventh.find(t=>t.name===d)?.description:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Question ",B," of 10"]}),e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Score: ",m.correct,"/",m.total,m.total>0&&e.jsxs("span",{style:{color:"var(--text-muted)"},className:"ml-2",children:["(",H,"%)"]})]})]}),e.jsxs("div",{className:"p-8 rounded-lg text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ§"}),e.jsx("p",{className:"text-lg font-medium",style:{color:"var(--text-primary)"},children:W()}),e.jsx("button",{onClick:S,className:"btn-secondary mt-4 flex items-center gap-2 mx-auto",disabled:l!==null,children:"ðŸ”Š Play Again"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-md mx-auto",role:"group","aria-label":`Answer options. Press number keys 1 through ${u.length} to select an answer`,children:u.map((t,r)=>{let s={padding:"1rem",borderRadius:"0.5rem",fontWeight:"bold",transition:"all 0.2s",border:"none",cursor:l===null?"pointer":"default"};return l===null?(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-primary)"):t===d?(s.backgroundColor="var(--success)",s.color="white"):t===l?(s.backgroundColor="var(--error)",s.color="white"):(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-muted)",s.opacity=.5),e.jsxs("button",{onClick:()=>O(t),disabled:l!==null,style:s,className:"hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":`Option ${r+1}: ${t}. Press ${r+1} to select`,"aria-pressed":l===t,children:[e.jsxs("span",{className:"sr-only",children:[r+1,": "]}),t]},t)})}),e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{"aria-hidden":"true",children:"Tip: Press number keys to quickly select an answer"}),e.jsxs("span",{className:"sr-only",children:["Use number keys 1 through ",u.length," to select answers"]})]}),_&&e.jsxs("div",{className:"text-center p-4 rounded-lg animate-fade-in",style:{backgroundColor:v?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)"},role:"alert","aria-live":"assertive",children:[e.jsxs("p",{className:"font-medium text-lg",style:{color:v?"var(--success)":"var(--error)"},children:[e.jsx("span",{"aria-hidden":"true",children:v?"âœ“":"âœ—"}),v?" Correct!":` Incorrect. The answer was ${d}`]}),R()&&e.jsxs("p",{className:"text-sm mt-2",style:{color:"var(--text-secondary)"},children:["Hint: ",R()]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Quick Reference"}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--text-secondary)"},children:[a==="chord-basic"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Major:"})," Bright, happy, resolved"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Minor:"})," Dark, sad, introspective"]})]}),a==="chord-seventh"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Major 7th:"})," Dreamy, sophisticated"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Minor 7th:"})," Mellow, smooth"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dominant 7th:"})," Tense, bluesy"]})]}),a==="scale-degree"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1 (Do):"})," Home, stable"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"5 (Sol):"})," Strong, supportive"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"7 (Ti):"})," Leading tone, wants to resolve to 1"]})]})]})]})]})};export{ee as default};
