import{u as Q,c as V,d as X,r as x,l as k,n as Z,s as G,j as e,F as ee,m as te,g as A,i as K,f as oe,p as se}from"./index-Ckc1dp_q.js";import{a as M}from"./theoryEngine-B8tyCBzy.js";import{D as ne}from"./DisplayModeToggle-v7ZEYMBC.js";import{P as re}from"./PracticeRating-CKX4OH4i.js";import"./tone-BDbzsNEa.js";const ae=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],H=["Ionian (Major)","Dorian","Phrygian","Lydian","Mixolydian","Aeolian (Natural Minor)","Locrian"],ie=[5,0,1,2,4],le=[0,1,2,4,5],ce=["Root","b3","4","5","b7"],de=["Root","2","3","5","6"];function I(d){return d.map(m=>k(m).chroma).filter(m=>m!==void 0)}function J(d){return te(d)||d}function $(d,m,g,b,v){const y=M(d,m==="minor"?"minor pentatonic":"major pentatonic");if(!y||y.length===0)return[];const N=I(y),w=N[0],h=[];for(let o=0;o<=22;o++){const s=A({string:0,fret:o},b),a=k(s).chroma;a!==void 0&&N.includes(a)&&h.push({fret:o,chroma:a})}const j=h.findIndex(o=>o.chroma===w);if(j===-1)return[];const S=j+g;if(S>=h.length)return[];let r=h[S].fret;r>12&&(r-=12);const c=[];for(let o=0;o<v;o++){const s=[];for(let l=0;l<=22;l++){const n=A({string:o,fret:l},b),u=k(n).chroma;u!==void 0&&N.includes(u)&&s.push(l)}let a=[],i=1/0;for(let l=0;l<s.length-1;l++){const n=[s[l],s[l+1]];if(n[0]>=r-1&&n[1]<=r+4){const u=Math.abs(n[0]-r);u<i&&(i=u,a=n)}}if(a.length===0)for(let l=0;l<s.length-1;l++){const n=[s[l],s[l+1]];if(n[1]-n[0]<=5){const u=(n[0]+n[1])/2,D=Math.abs(u-(r+1.5));D<i&&(i=D,a=n)}}a.forEach(l=>c.push({string:o,fret:l}))}return c}function me(d,m,g,b,v){if(d.length===0)return[];const P=g==="minor"?"minor pentatonic":"major pentatonic",y=g==="minor"?"aeolian":"major",N=I(M(m,P)),h=I(M(m,y)).filter(o=>!N.includes(o));if(h.length===0)return[];const j=d.map(o=>o.fret),S=Math.min(...j),r=Math.max(...j),c=[];for(let o=0;o<v;o++)for(let s=Math.max(0,S-1);s<=r+1;s++){const a=A({string:o,fret:s},b),i=k(a).chroma;i!==void 0&&h.includes(i)&&c.push({string:o,fret:s})}return c}const ge=({exercise:d})=>{const{stringCount:m,tuning:g,setHighlightedPositions:b,setSecondaryHighlightedPositions:v,setRootNote:P,clearHighlights:y}=Q(),{droneConfig:N,setDroneConfig:w,isDroneActive:h,setDroneActive:j}=V(),{isActive:S}=X(),[r,c]=x.useState("A"),[o,s]=x.useState("minor"),[a,i]=x.useState(0),[l,n]=x.useState(!1),[u,D]=x.useState(!1);x.useEffect(()=>{const t=d.id;t==="pentatonic-1"?(s("minor"),i(0),n(!1),c("A")):t==="pentatonic-minor-2"?(s("minor"),i(1),n(!1),c("A")):t==="pentatonic-minor-3"?(s("minor"),i(2),n(!1),c("A")):t==="pentatonic-minor-4"?(s("minor"),i(3),n(!1),c("A")):t==="pentatonic-minor-5"?(s("minor"),i(4),n(!1),c("A")):t==="pentatonic-major-1"?(s("major"),i(0),n(!1),c("C")):t==="pentatonic-major-2"?(s("major"),i(1),n(!1),c("C")):t==="pentatonic-major-3"?(s("major"),i(2),n(!1),c("C")):t==="pentatonic-major-4"?(s("major"),i(3),n(!1),c("C")):t==="pentatonic-major-5"?(s("major"),i(4),n(!1),c("C")):t==="pentatonic-4"&&(s("minor"),i(0),n(!0),c("A"))},[d.id]);const R=o==="minor"?ie:le,_=o==="minor"?ce:de,B=H[R[a]],z=_[a],U=x.useCallback(()=>{const t=o==="minor"?"minor pentatonic":"major pentatonic",p=o==="minor"?"aeolian":"major",E=I(M(r,t));return M(r,p).filter(C=>{const L=k(C).chroma;return L!==void 0&&!E.includes(L)}).map(J)},[r,o]),W=x.useCallback(()=>{const p=M(r,o==="minor"?"minor pentatonic":"major pentatonic");return a<p.length?J(p[a]):r},[r,o,a]),O=x.useCallback(()=>{if(!S)return;const t=$(r,o,a,g,m);if(b(t),P(Z(r)),l){const p=me(t,r,o,g,m);v(p)}else v([])},[S,r,o,a,l,g,m,b,v,P]);x.useEffect(()=>{O()},[O]),x.useEffect(()=>()=>{y(),h&&(G(),j(!1))},[y,h,j]);const Y=async()=>{await K(),h?(G(),j(!1)):(w({note:r,octave:2}),oe({note:r,octave:2,volume:N.volume,waveform:N.waveform}),j(!0))},q=async()=>{if(u)return;await K(),D(!0);const p=[...$(r,o,a,g,m)].sort((f,C)=>f.string!==C.string?f.string-C.string:f.fret-C.fret),E=.25;for(let f=0;f<p.length;f++){const C=A(p[f],g);se(C,{duration:.4,velocity:.7,delay:f*E})}setTimeout(()=>D(!1),p.length*E*1e3+500)},T=U(),F=W();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Scale Type"}),e.jsx("div",{className:"flex gap-2",children:["minor","major"].map(t=>e.jsxs("button",{onClick:()=>s(t),className:`flex-1 py-2 rounded-lg font-medium transition-all ${o===t?"btn-primary":""}`,style:o!==t?{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"}:{},children:[t==="minor"?"Minor":"Major"," Pent."]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:r,onChange:t=>c(t.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:ae.map(t=>e.jsxs("option",{value:t,children:[t," ",o==="minor"?"Minor":"Major"," Pentatonic"]},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Shape / Box"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3,4].map(t=>e.jsx("button",{onClick:()=>i(t),className:`flex-1 py-2 rounded-lg font-bold transition-all ${a===t?"btn-primary":""}`,style:a!==t?{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"}:{},children:t+1},t))})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsxs("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:["Shape ",a+1," — ",r," ",o==="minor"?"Minor":"Major"," Pentatonic"]}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--text-secondary)"},children:[e.jsxs("p",{children:["Starts from the ",e.jsx("strong",{children:z})," (",F,") on the lowest string"]}),e.jsxs("p",{children:["Extends to: ",e.jsxs("strong",{children:[F," ",B]})," by adding ",T.join(" and ")]}),o==="minor"&&e.jsx("p",{className:"mt-1",style:{color:"var(--text-muted)"},children:"Minor pentatonic = 1 b3 4 5 b7 — missing the 2nd and 6th degrees"}),o==="major"&&e.jsx("p",{className:"mt-1",style:{color:"var(--text-muted)"},children:"Major pentatonic = 1 2 3 5 6 — missing the 4th and 7th degrees"})]})]}),d.id==="pentatonic-4"&&e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--accent-primary)"},children:[e.jsx("h4",{className:"font-medium mb-3",style:{color:"var(--accent-primary)"},children:"Shape → Mode Reference"}),e.jsx("div",{className:"grid grid-cols-1 gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[0,1,2,3,4].map(t=>{const p=H[R[t]],E=_[t],f=a===t;return e.jsxs("button",{onClick:()=>i(t),className:"text-left p-2 rounded transition-all",style:{backgroundColor:f?"rgba(59, 130, 246, 0.15)":"transparent",color:f?"var(--accent-primary)":"var(--text-secondary)",fontWeight:f?"bold":"normal"},children:["Shape ",t+1," (",E,") → ",p]},t)})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:t=>n(t.target.checked),className:"rounded"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:["Show Full Scale (+",T.join(", "),")"]})]}),e.jsx(ne,{})]}),e.jsx("div",{className:"card p-4",children:e.jsx(ee,{interactive:!0})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("button",{onClick:Y,className:h?"btn-danger":"btn-success",children:h?"Stop Drone":"Play Drone"}),e.jsx("button",{onClick:q,disabled:u,className:"btn-secondary disabled:opacity-50",children:u?"Playing...":"Play Scale"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Practice Tips"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",style:{color:"var(--text-secondary)"},children:[e.jsx("li",{children:"Master each shape individually before connecting them"}),e.jsx("li",{children:'Look for the "rectangle" — two adjacent strings where the minor 3rd intervals sit; the 2 extension notes always land here'}),e.jsx("li",{children:'Toggle "Show Full Scale" to see how adding 2 notes turns the pentatonic into a full mode'}),e.jsx("li",{children:"Try the same lick in all 5 shapes to build fretboard freedom"}),e.jsx("li",{children:"Each box connects to the next — the top notes of one box overlap with the bottom of the next"}),e.jsx("li",{children:"Use the drone to hear how pentatonic notes relate to the root"}),l&&e.jsxs("li",{children:["The faded notes (",T.join(" and "),") turn this shape into ",F," ",B]})]})]}),e.jsx(re,{exerciseId:d.id,exerciseType:d.type})]})};export{ge as default};
