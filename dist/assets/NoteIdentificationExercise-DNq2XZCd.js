import{u as G,r as o,i as K,g as U,n as _,N as B,a as F,p as v,j as e,F as J,b as V}from"./index-CwJpEdkT.js";import{u as X}from"./useExercise-7j3GFP1J.js";import{D as Y}from"./DisplayModeToggle-BpGImax5.js";import"./tone-BWNjRQgH.js";const re=({exercise:d})=>{const{stringCount:m,tuning:N,setHighlightedPositions:b,setRootNote:j,clearHighlights:p}=G(),{score:c,questionNumber:T,isActive:l,recordAnswer:w,scorePercentage:M}=X({exerciseId:d.id,exerciseType:d.type,totalQuestions:10}),[n,O]=o.useState(null),[f,D]=o.useState(""),[u,I]=o.useState(""),[x,Q]=o.useState([]),[a,k]=o.useState(null),[h,S]=o.useState(null),[$,C]=o.useState(!1),[q,g]=o.useState([]),P=o.useRef(()=>{});o.useEffect(()=>{const t=r=>{if(!l||a!==null)return;const s={1:0,2:1,3:2,4:3};if(r.key in s){const i=s[r.key];i<x.length&&(r.preventDefault(),P.current(x[i]))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[l,a,x]);const A=d.difficulty<=1?5:d.difficulty<=2?12:22,y=o.useCallback(async()=>{await K();const t=V(m,A,0),r=U(t,N),s=r.replace(/\d/,""),i=_(s),H=B.filter(W=>!F(W,i)).sort(()=>Math.random()-.5).slice(0,3),L=[i,...H].sort(()=>Math.random()-.5);O(t),D(i),I(r),Q(L),k(null),S(null),C(!1),g([]),b([t]),j(null),setTimeout(()=>{v(r,{duration:1.5,velocity:.7})},300)},[m,N,A,b,j]),E=o.useRef(y);E.current=y,o.useEffect(()=>(l?E.current():(p(),g([])),()=>{p(),g([])}),[l,p]);const z=()=>{u&&v(u,{duration:1.5,velocity:.7})},R=o.useCallback(t=>{if(a!==null||!l||!n)return;k(t);const r=F(t,f);S(r),C(!0),g([n]),w(r),v(u,{duration:1,velocity:.6}),setTimeout(()=>{c.total+1<10&&y()},2e3)},[a,l,n,f,u,c.total,w,y]);return P.current=R,e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Question ",T," of 10"]}),e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Score: ",c.correct,"/",c.total,c.total>0&&e.jsxs("span",{style:{color:"var(--text-muted)"},className:"ml-2",children:["(",M,"%)"]})]})]}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(Y,{compact:!0})}),e.jsx("div",{className:"card p-4",children:e.jsx(J,{interactive:!1,hideNoteNames:!0,revealedPositions:q})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--text-primary)"},children:"What note is highlighted on the fretboard?"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[n&&e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["String ",m-n.string,", Fret ",n.fret]}),e.jsx("button",{onClick:z,className:"btn-secondary text-sm flex items-center gap-1",disabled:a!==null,children:"ðŸ”Š Play Again"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-2xl mx-auto",role:"group","aria-label":"Answer options. Press 1, 2, 3, or 4 to select an answer",children:x.map((t,r)=>{let s={padding:"1rem 1.5rem",borderRadius:"0.5rem",fontWeight:"bold",fontSize:"1.125rem",transition:"all 0.2s",border:"none",cursor:a===null?"pointer":"default"};return a===null?(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-primary)"):t===f?(s.backgroundColor="var(--success)",s.color="white"):t===a?(s.backgroundColor="var(--error)",s.color="white"):(s.backgroundColor="var(--bg-tertiary)",s.color="var(--text-muted)",s.opacity=.5),e.jsxs("button",{onClick:()=>R(t),disabled:a!==null,style:s,className:"hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":`Option ${r+1}: ${t}. Press ${r+1} to select`,"aria-pressed":a===t,children:[e.jsxs("span",{className:"sr-only",children:[r+1,": "]}),t]},t)})}),e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{"aria-hidden":"true",children:"Tip: Press 1, 2, 3, or 4 to quickly select an answer"}),e.jsx("span",{className:"sr-only",children:"Use number keys 1 through 4 to select answers"})]}),$&&e.jsxs("div",{className:"text-center p-4 rounded-lg animate-fade-in",style:{backgroundColor:h?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)"},role:"alert","aria-live":"assertive",children:[e.jsxs("p",{className:"font-medium text-lg",style:{color:h?"var(--success)":"var(--error)"},children:[e.jsx("span",{"aria-hidden":"true",children:h?"âœ“":"âœ—"}),h?" Correct!":` Incorrect. The answer was ${f}`]}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:[u," - String ",n?m-n.string:"",", Fret ",n?.fret]})]})]})};export{re as default};
