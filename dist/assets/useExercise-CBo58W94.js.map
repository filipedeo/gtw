{"version":3,"file":"useExercise-CBo58W94.js","sources":["../../src/hooks/useExercise.ts"],"sourcesContent":["import { useState, useCallback, useEffect, useRef } from 'react';\nimport { useExerciseStore } from '../stores/exerciseStore';\nimport { useProgressStore } from '../stores/progressStore';\n\ninterface UseExerciseOptions {\n  exerciseId: string;\n  totalQuestions?: number;\n  onComplete?: (score: number) => void;\n}\n\ninterface UseExerciseReturn {\n  // State\n  score: { correct: number; total: number };\n  questionNumber: number;\n  isComplete: boolean;\n  isActive: boolean;\n\n  // Actions\n  recordAnswer: (correct: boolean) => void;\n  resetExercise: () => void;\n\n  // Computed\n  scorePercentage: number;\n  questionsRemaining: number;\n}\n\nconst DEFAULT_TOTAL_QUESTIONS = 10;\n\nexport function useExercise(options: UseExerciseOptions): UseExerciseReturn {\n  const { exerciseId, totalQuestions = DEFAULT_TOTAL_QUESTIONS, onComplete } = options;\n\n  // Store hooks\n  const { isActive, recordAttempt, endExercise, startTime } = useExerciseStore();\n  const { recordExerciseCompletion, updateReviewItem } = useProgressStore();\n\n  // Local state\n  const [score, setScore] = useState({ correct: 0, total: 0 });\n  const [isComplete, setIsComplete] = useState(false);\n\n  // Ref to track if completion has been called to prevent double-firing\n  const completionCalledRef = useRef(false);\n\n  // Reset state when exercise becomes active\n  useEffect(() => {\n    if (isActive) {\n      setScore({ correct: 0, total: 0 });\n      setIsComplete(false);\n      completionCalledRef.current = false;\n    }\n  }, [isActive]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      // Reset completion ref on unmount\n      completionCalledRef.current = false;\n    };\n  }, []);\n\n  const recordAnswer = useCallback(\n    (correct: boolean) => {\n      if (!isActive || isComplete) return;\n\n      // Update local score\n      const newScore = {\n        correct: score.correct + (correct ? 1 : 0),\n        total: score.total + 1,\n      };\n      setScore(newScore);\n\n      // Record attempt in exercise store\n      recordAttempt(correct);\n\n      // Check if exercise is complete\n      if (newScore.total >= totalQuestions) {\n        if (completionCalledRef.current) return;\n        completionCalledRef.current = true;\n\n        setIsComplete(true);\n\n        // Calculate final score\n        const finalScore = newScore.correct / newScore.total;\n        const timeSpent = startTime ? (Date.now() - startTime) / 1000 : 0;\n\n        // Record to progress/spaced repetition system\n        recordExerciseCompletion(exerciseId, finalScore, timeSpent);\n\n        // Update review item with quality based on score\n        // Quality: 5 = perfect, 4 = good, 3 = acceptable, 2 = hard, 1 = failed\n        const quality = finalScore >= 0.8 ? 5 : finalScore >= 0.6 ? 3 : 1;\n        updateReviewItem(exerciseId, quality);\n\n        // End exercise in store\n        endExercise({\n          exerciseId,\n          score: finalScore,\n          timeSpent,\n          attempts: newScore.total,\n          completedAt: new Date(),\n        });\n\n        // Call completion callback if provided\n        if (onComplete) {\n          onComplete(finalScore);\n        }\n      }\n    },\n    [\n      isActive,\n      isComplete,\n      score,\n      totalQuestions,\n      startTime,\n      exerciseId,\n      recordAttempt,\n      recordExerciseCompletion,\n      updateReviewItem,\n      endExercise,\n      onComplete,\n    ]\n  );\n\n  const resetExercise = useCallback(() => {\n    setScore({ correct: 0, total: 0 });\n    setIsComplete(false);\n    completionCalledRef.current = false;\n  }, []);\n\n  // Computed values\n  const scorePercentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;\n  const questionsRemaining = totalQuestions - score.total;\n  const questionNumber = score.total + 1;\n\n  return {\n    // State\n    score,\n    questionNumber,\n    isComplete,\n    isActive,\n\n    // Actions\n    recordAnswer,\n    resetExercise,\n\n    // Computed\n    scorePercentage,\n    questionsRemaining,\n  };\n}\n\nexport default useExercise;\n"],"names":["DEFAULT_TOTAL_QUESTIONS","useExercise","options","exerciseId","totalQuestions","onComplete","isActive","recordAttempt","endExercise","startTime","useExerciseStore","recordExerciseCompletion","updateReviewItem","useProgressStore","score","setScore","useState","isComplete","setIsComplete","completionCalledRef","useRef","useEffect","recordAnswer","useCallback","correct","newScore","finalScore","timeSpent","quality","resetExercise","scorePercentage","questionsRemaining","questionNumber"],"mappings":"sDA0BA,MAAMA,EAA0B,GAEzB,SAASC,EAAYC,EAAgD,CAC1E,KAAM,CAAE,WAAAC,EAAY,eAAAC,EAAiBJ,EAAyB,WAAAK,GAAeH,EAGvE,CAAE,SAAAI,EAAU,cAAAC,EAAe,YAAAC,EAAa,UAAAC,CAAA,EAAcC,EAAA,EACtD,CAAE,yBAAAC,EAA0B,iBAAAC,CAAA,EAAqBC,EAAA,EAGjD,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EACrD,CAACC,EAAYC,CAAa,EAAIF,EAAAA,SAAS,EAAK,EAG5CG,EAAsBC,EAAAA,OAAO,EAAK,EAGxCC,EAAAA,UAAU,IAAM,CACVf,IACFS,EAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EACjCG,EAAc,EAAK,EACnBC,EAAoB,QAAU,GAElC,EAAG,CAACb,CAAQ,CAAC,EAGbe,EAAAA,UAAU,IACD,IAAM,CAEXF,EAAoB,QAAU,EAChC,EACC,CAAA,CAAE,EAEL,MAAMG,EAAeC,EAAAA,YAClBC,GAAqB,CACpB,GAAI,CAAClB,GAAYW,EAAY,OAG7B,MAAMQ,EAAW,CACf,QAASX,EAAM,SAAWU,EAAU,EAAI,GACxC,MAAOV,EAAM,MAAQ,CAAA,EAQvB,GANAC,EAASU,CAAQ,EAGjBlB,EAAciB,CAAO,EAGjBC,EAAS,OAASrB,EAAgB,CACpC,GAAIe,EAAoB,QAAS,OACjCA,EAAoB,QAAU,GAE9BD,EAAc,EAAI,EAGlB,MAAMQ,EAAaD,EAAS,QAAUA,EAAS,MACzCE,EAAYlB,GAAa,KAAK,MAAQA,GAAa,IAAO,EAGhEE,EAAyBR,EAAYuB,EAAYC,CAAS,EAI1D,MAAMC,EAAUF,GAAc,GAAM,EAAIA,GAAc,GAAM,EAAI,EAChEd,EAAiBT,EAAYyB,CAAO,EAGpCpB,EAAY,CACV,WAAAL,EACA,MAAOuB,EACP,UAAAC,EACA,SAAUF,EAAS,MACnB,gBAAiB,IAAK,CACvB,EAGGpB,GACFA,EAAWqB,CAAU,CAEzB,CACF,EACA,CACEpB,EACAW,EACAH,EACAV,EACAK,EACAN,EACAI,EACAI,EACAC,EACAJ,EACAH,CAAA,CACF,EAGIwB,EAAgBN,EAAAA,YAAY,IAAM,CACtCR,EAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EACjCG,EAAc,EAAK,EACnBC,EAAoB,QAAU,EAChC,EAAG,CAAA,CAAE,EAGCW,EAAkBhB,EAAM,MAAQ,EAAI,KAAK,MAAOA,EAAM,QAAUA,EAAM,MAAS,GAAG,EAAI,EACtFiB,EAAqB3B,EAAiBU,EAAM,MAC5CkB,EAAiBlB,EAAM,MAAQ,EAErC,MAAO,CAEL,MAAAA,EACA,eAAAkB,EACA,WAAAf,EACA,SAAAX,EAGA,aAAAgB,EACA,cAAAO,EAGA,gBAAAC,EACA,mBAAAC,CAAA,CAEJ"}