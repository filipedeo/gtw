import{u as le,c as ce,d as de,r as f,l as I,n as me,g as B,s as Q,j as e,F as he,m as pe,i as V,f as fe,p as ue}from"./index-Bh8m2kJL.js";import{a as C}from"./theoryEngine-D1KmJQ7i.js";import{D as ge}from"./DisplayModeToggle-Ctv2J-cT.js";import{P as xe}from"./PracticeRating-mt1Y0dfs.js";import"./tone-BDbzsNEa.js";const Z=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],ee=["Ionian (Major)","Dorian","Phrygian","Lydian","Mixolydian","Aeolian (Natural Minor)","Locrian"],je=[5,0,1,2,4],ye=[0,1,2,4,5],Ne=["Root","b3","4","5","b7"],ve=["Root","2","3","5","6"],H=[{name:"aeolian",displayName:"Aeolian (Natural Minor)"},{name:"dorian",displayName:"Dorian"},{name:"phrygian",displayName:"Phrygian"}],K=[{name:"major",displayName:"Ionian (Major)"},{name:"lydian",displayName:"Lydian"},{name:"mixolydian",displayName:"Mixolydian"}],G=[{name:"blues",displayName:"Blues Scale"},{name:"harmonic minor",displayName:"Harmonic Minor"},{name:"melodic minor",displayName:"Melodic Minor (Jazz Minor)"}];function _(i){return i.map(h=>I(h).chroma).filter(h=>h!==void 0)}function J(i){return pe(i)||i}function be(i,h,u){const S=_(C(i,h==="minor"?"minor pentatonic":"major pentatonic")),T=_(C(i,u));return S.filter(N=>!T.includes(N))}function te(i,h,u,x,S){const N=C(i,h==="minor"?"minor pentatonic":"major pentatonic");if(!N||N.length===0)return[];const D=_(N),O=D[0],j=[];for(let n=0;n<=22;n++){const o=B({string:0,fret:n},x),a=I(o).chroma;a!==void 0&&D.includes(a)&&j.push({fret:n,chroma:a})}const v=j.findIndex(n=>n.chroma===O);if(v===-1)return[];const w=v+u;if(w>=j.length)return[];let s=j[w].fret;s>12&&(s-=12);const d=[];for(let n=0;n<S;n++){const o=[];for(let l=0;l<=22;l++){const r=B({string:n,fret:l},x),y=I(r).chroma;y!==void 0&&D.includes(y)&&o.push(l)}let a=[],c=1/0;for(let l=0;l<o.length-1;l++){const r=[o[l],o[l+1]];if(r[0]>=s-1&&r[1]<=s+4){const y=Math.abs(r[0]-s);y<c&&(c=y,a=r)}}if(a.length===0)for(let l=0;l<o.length-1;l++){const r=[o[l],o[l+1]];if(r[1]-r[0]<=5){const y=(r[0]+r[1])/2,R=Math.abs(y-(s+1.5));R<c&&(c=R,a=r)}}a.forEach(l=>d.push({string:n,fret:l}))}return d}function Me(i,h,u,x,S,T){if(i.length===0)return[];const N=u==="minor"?"minor pentatonic":"major pentatonic",D=T||(u==="minor"?"aeolian":"major"),O=_(C(h,N)),v=_(C(h,D)).filter(o=>!O.includes(o));if(v.length===0)return[];const w=i.map(o=>o.fret),s=Math.min(...w),d=Math.max(...w),n=[];for(let o=0;o<S;o++)for(let a=Math.max(0,s-1);a<=d+1;a++){const c=B({string:o,fret:a},x),l=I(c).chroma;l!==void 0&&v.includes(l)&&n.push({string:o,fret:a})}return n}const Ae=({exercise:i})=>{const{stringCount:h,tuning:u,setHighlightedPositions:x,setSecondaryHighlightedPositions:S,setRootNote:T,clearHighlights:N}=le(),{droneConfig:D,setDroneConfig:O,isDroneActive:j,setDroneActive:v}=ce(),{isActive:w}=de(),[s,d]=f.useState("A"),[n,o]=f.useState("minor"),[a,c]=f.useState(0),[l,r]=f.useState(!1),[y,R]=f.useState(!1),[g,z]=f.useState(null);f.useEffect(()=>{const t=i.id;t==="pentatonic-1"?(o("minor"),c(0),r(!1),d("A")):t==="pentatonic-minor-2"?(o("minor"),c(1),r(!1),d("A")):t==="pentatonic-minor-3"?(o("minor"),c(2),r(!1),d("A")):t==="pentatonic-minor-4"?(o("minor"),c(3),r(!1),d("A")):t==="pentatonic-minor-5"?(o("minor"),c(4),r(!1),d("A")):t==="pentatonic-major-1"?(o("major"),c(0),r(!1),d("C")):t==="pentatonic-major-2"?(o("major"),c(1),r(!1),d("C")):t==="pentatonic-major-3"?(o("major"),c(2),r(!1),d("C")):t==="pentatonic-major-4"?(o("major"),c(3),r(!1),d("C")):t==="pentatonic-major-5"?(o("major"),c(4),r(!1),d("C")):t==="pentatonic-4"?(o("minor"),c(0),r(!0),d("A")):t==="pentatonic-5"&&(o("minor"),c(0),r(!0),d("A"),z("aeolian"))},[i.id]),f.useEffect(()=>{i.id!=="pentatonic-5"||!g||(H.some(t=>t.name===g)||G.some(t=>t.name===g)?o("minor"):K.some(t=>t.name===g)&&o("major"))},[g,i.id]);const U=n==="minor"?je:ye,W=n==="minor"?Ne:ve,X=ee[U[a]],ne=W[a],oe=f.useCallback(t=>{const p=n==="minor"?"minor pentatonic":"major pentatonic",b=t||(n==="minor"?"aeolian":"major"),m=_(C(s,p));return C(s,b).filter(F=>{const L=I(F).chroma;return L!==void 0&&!m.includes(L)}).map(J)},[s,n]),se=f.useCallback(()=>{const p=C(s,n==="minor"?"minor pentatonic":"major pentatonic");return a<p.length?J(p[a]):s},[s,n,a]),Y=f.useCallback(()=>{if(!w)return;const t=te(s,n,a,u,h);if(T(me(s)),l){const p=i.id==="pentatonic-5"&&g||void 0;if(p){const m=be(s,n,p);if(m.length>0){const M=t.filter(F=>{const L=B(F,u),q=I(L).chroma;return q===void 0||!m.includes(q)});x(M)}else x(t)}else x(t);const b=Me(t,s,n,u,h,p);S(b)}else x(t),S([])},[w,s,n,a,l,u,h,g,i.id,x,S,T]);f.useEffect(()=>{Y()},[Y]),f.useEffect(()=>()=>{N(),j&&(Q(),v(!1))},[N,j,v]);const ae=async()=>{await V(),j?(Q(),v(!1)):(O({note:s,octave:2}),fe({note:s,octave:2,volume:D.volume,waveform:D.waveform}),v(!0))},re=async()=>{if(y)return;await V(),R(!0);const p=[...te(s,n,a,u,h)].sort((m,M)=>m.string!==M.string?m.string-M.string:m.fret-M.fret),b=.25;for(let m=0;m<p.length;m++){const M=B(p[m],u);ue(M,{duration:.4,velocity:.7,delay:m*b})}setTimeout(()=>R(!1),p.length*b*1e3+500)},ie=f.useCallback(t=>{if(!t)return[];const b=C(s,n==="minor"?"minor pentatonic":"major pentatonic"),m=_(C(s,t));return b.filter(M=>{const F=I(M).chroma;return F!==void 0&&!m.includes(F)}).map(J)},[s,n]),E=oe(i.id==="pentatonic-5"&&g||void 0),P=ie(i.id==="pentatonic-5"&&g||void 0),$=se(),k=i.id==="pentatonic-5",A=[...H,...K,...G].find(t=>t.name===g)?.displayName??g??"";return e.jsxs("div",{className:"space-y-6",children:[k&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Target Mode"}),e.jsxs("select",{value:g||"",onChange:t=>z(t.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:[e.jsx("optgroup",{label:"Minor Modes (from minor pentatonic)",children:H.map(t=>e.jsx("option",{value:t.name,children:t.displayName},t.name))}),e.jsx("optgroup",{label:"Major Modes (from major pentatonic)",children:K.map(t=>e.jsx("option",{value:t.name,children:t.displayName},t.name))}),e.jsx("optgroup",{label:"Other Scales (from minor pentatonic)",children:G.map(t=>e.jsx("option",{value:t.name,children:t.displayName},t.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:s,onChange:t=>d(t.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:Z.map(t=>e.jsxs("option",{value:t,children:[t," ",A]},t))})]})]}),!k&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Scale Type"}),e.jsx("div",{className:"flex gap-2",children:["minor","major"].map(t=>e.jsxs("button",{onClick:()=>o(t),className:`flex-1 py-2 rounded-lg font-medium transition-all ${n===t?"btn-primary":""}`,style:n!==t?{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"}:{},children:[t==="minor"?"Minor":"Major"," Pent."]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:s,onChange:t=>d(t.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:Z.map(t=>e.jsxs("option",{value:t,children:[t," ",n==="minor"?"Minor":"Major"," Pentatonic"]},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Shape / Box"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3,4].map(t=>e.jsx("button",{onClick:()=>c(t),className:`flex-1 py-2 rounded-lg font-bold transition-all ${a===t?"btn-primary":""}`,style:a!==t?{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"}:{},children:t+1},t))})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:k?`Shape ${a+1} — ${s} ${A}`:`Shape ${a+1} — ${s} ${n==="minor"?"Minor":"Major"} Pentatonic`}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--text-secondary)"},children:[e.jsxs("p",{children:["Starts from the ",e.jsx("strong",{children:ne})," (",$,") on the lowest string"]}),k?e.jsxs("p",{children:[n==="minor"?"Minor":"Major"," pentatonic + ",e.jsx("strong",{children:E.join(", ")}),P.length>0&&e.jsxs(e.Fragment,{children:[", replacing ",e.jsx("strong",{children:P.join(", ")})]})," ","= ",s," ",A]}):e.jsxs("p",{children:["Extends to: ",e.jsxs("strong",{children:[$," ",X]})," by adding ",E.join(" and ")]}),n==="minor"&&e.jsx("p",{className:"mt-1",style:{color:"var(--text-muted)"},children:"Minor pentatonic = 1 b3 4 5 b7 — missing the 2nd and 6th degrees"}),n==="major"&&e.jsx("p",{className:"mt-1",style:{color:"var(--text-muted)"},children:"Major pentatonic = 1 2 3 5 6 — missing the 4th and 7th degrees"})]})]}),k&&E.length>0&&e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--accent-primary)"},children:[e.jsxs("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:["Extension Notes for ",s," ",A]}),e.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--text-secondary)"},children:[e.jsxs("p",{children:[E.length," note",E.length!==1?"s":""," that distinguish ",A," from the ",n," pentatonic: ",e.jsx("strong",{children:E.join(", ")})]}),P.length>0&&e.jsxs("p",{children:["The pentatonic's ",e.jsx("strong",{children:P.join(", ")})," ",P.length===1?"is":"are"," not part of ",A," and ",P.length===1?"is":"are"," hidden from the display."]}),e.jsx("p",{children:"These are the same pitch classes in every shape — only their fretboard positions change as you move across shapes."})]})]}),i.id==="pentatonic-4"&&e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--accent-primary)"},children:[e.jsx("h4",{className:"font-medium mb-3",style:{color:"var(--accent-primary)"},children:"Shape → Mode Reference"}),e.jsx("div",{className:"grid grid-cols-1 gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[0,1,2,3,4].map(t=>{const p=ee[U[t]],b=W[t],m=a===t;return e.jsxs("button",{onClick:()=>c(t),className:"text-left p-2 rounded transition-all",style:{backgroundColor:m?"rgba(59, 130, 246, 0.15)":"transparent",color:m?"var(--accent-primary)":"var(--text-secondary)",fontWeight:m?"bold":"normal"},children:["Shape ",t+1," (",b,") → ",p]},t)})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[!k&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:t=>r(t.target.checked),className:"rounded"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:["Show Full Scale (+",E.join(", "),")"]})]}),e.jsx(ge,{})]}),e.jsx("div",{className:"card p-4",children:e.jsx(he,{interactive:!0})}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("button",{onClick:ae,className:j?"btn-danger":"btn-success",children:j?"Stop Drone":"Play Drone"}),e.jsx("button",{onClick:re,disabled:y,className:"btn-secondary disabled:opacity-50",children:y?"Playing...":"Play Scale"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Practice Tips"}),e.jsx("ul",{className:"text-sm space-y-1 list-disc list-inside",style:{color:"var(--text-secondary)"},children:k?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["Cycle through all 5 shapes to see how ",E.join(", ")," appear in different positions"]}),e.jsx("li",{children:"The extension notes are always the same pitch classes — notice how their fretboard locations shift per shape"}),P.length>0&&e.jsxs("li",{children:["The pentatonic's ",P.join(", ")," ",P.length===1?"is":"are"," replaced in ",A," — practice hearing the difference"]}),e.jsx("li",{children:"Try switching between scales (e.g., Dorian vs Harmonic Minor) to see which notes change"}),e.jsxs("li",{children:["Use the drone to hear the color of ",A," over the root"]}),e.jsx("li",{children:"Each box connects to the next — the top notes of one box overlap with the bottom of the next"}),e.jsx("li",{children:"Practice improvising in each shape using the pentatonic backbone + the extension notes"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"Master each shape individually before connecting them"}),e.jsx("li",{children:'Look for the "rectangle" — two adjacent strings where the minor 3rd intervals sit; the 2 extension notes always land here'}),e.jsx("li",{children:'Toggle "Show Full Scale" to see how adding 2 notes turns the pentatonic into a full mode'}),e.jsx("li",{children:"Try the same lick in all 5 shapes to build fretboard freedom"}),e.jsx("li",{children:"Each box connects to the next — the top notes of one box overlap with the bottom of the next"}),e.jsx("li",{children:"Use the drone to hear how pentatonic notes relate to the root"}),l&&e.jsxs("li",{children:["The faded notes (",E.join(" and "),") turn this shape into ",$," ",X]})]})})]}),e.jsx(xe,{exerciseId:i.id,exerciseType:i.type})]})};export{Ae as default};
