import{u as q,d as U,r as a,n as K,e as L,i as X,p as Y,j as e,R as Q,F as V}from"./index-CWkcNJvv.js";import{a as N,s as Z,L as ee,b as te,S as se}from"./tone-BWNjRQgH.js";import{g as re,b as O,N as w}from"./theoryEngine-9EFmMbgm.js";import{J as E}from"./jamProgressions-ClHOGlWa.js";import{D as ae}from"./DisplayModeToggle-CFeXEIgS.js";import{P as ne}from"./PracticeRating-BZ6DiIj4.js";const oe=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],le={"bass-walk-1":"Blues","bass-walk-2":"Jazz","bass-walk-3":"Rock"};function G(l){const i=le[l];if(!i)return 0;const n=E.findIndex(f=>f.genre===i);return n>=0?n:0}function ce(){const l=new Set,i=[];for(const n of E)l.has(n.genre)||(l.add(n.genre),i.push(n.genre));return i}function ie(l,i,n){const f=O(l,i),h=[];for(let c=0;c<f.length;c++){const d=f[c],S=f[(c+1)%f.length],y=w.indexOf(d.root);if(y!==-1){if(h.push({note:`${d.root}2`,chordIndex:c}),n>=2){const o=d.intervals.length>1?d.intervals[1]:4,x=(y+o)%12;h.push({note:`${w[x]}2`,chordIndex:c})}if(n>=3){const o=d.intervals.length>2?d.intervals[2]:7,x=(y+o)%12;h.push({note:`${w[x]}2`,chordIndex:c})}if(n>=4){const o=w.indexOf(S.root);if(o!==-1){const x=(o-1+12)%12;h.push({note:`${w[x]}2`,chordIndex:c})}else{const x=d.intervals.length>2?d.intervals[2]:7,v=(y+x)%12;h.push({note:`${w[v]}2`,chordIndex:c})}}}}return h}const ge=({exercise:l})=>{const{stringCount:i,tuning:n,fretCount:f,setHighlightedPositions:h,setSecondaryHighlightedPositions:c,setRootNote:d,clearHighlights:S}=q(),{isActive:y}=U(),[o,x]=a.useState("C"),[v,M]=a.useState(()=>G(l.id)),[j,z]=a.useState(80),[I,T]=a.useState(!1),[R,$]=a.useState(-1),[B,_]=a.useState(!1),m=a.useRef(null),k=a.useRef(!1),u=E[v],H=ce();a.useEffect(()=>{const t=G(l.id);M(t)},[l.id]);const F=B?f:12,p=a.useMemo(()=>ie(o,u.degrees,u.beatsPerChord),[o,u.degrees,u.beatsPerChord]),A=a.useMemo(()=>[...new Set(p.map(t=>K(t.note.replace(/\d+$/,""))))],[p]);a.useEffect(()=>{if(y)try{const t=K(o),s=re(t,u.suggestedScale);if(s&&s.length>0){const r=L(s,n,i,F);h(r),d(t);const g=L(A,n,i,F);c(g)}}catch(t){console.error("Error updating walking bass fretboard:",t)}},[o,v,B,y,i,n,F,u,A,h,c,d]);const P=a.useCallback(()=>{m.current&&(m.current.stop(),m.current.dispose(),m.current=null),N().stop(),N().cancel(),k.current=!1,T(!1),$(-1)},[]),D=a.useCallback(async()=>{if(await X(),await Z(),p.length===0)return;const t=N();t.bpm.value=j,t.cancel();let s=0;m.current=new ee(r=>{const g=s%p.length,C=p[g];te().schedule(()=>{$(g)},r);try{const b=new se({oscillator:{type:"triangle"},envelope:{attack:.01,decay:.2,sustain:.3,release:.4}}).toDestination();b.volume.value=-6,b.triggerAttackRelease(C.note,"8n",r),b.triggerRelease(r+.4),setTimeout(()=>b.dispose(),2e3)}catch{Y(C.note,{duration:.4,velocity:.7})}s=(s+1)%p.length},"4n"),m.current.start(0),t.start(),k.current=!0,T(!0)},[j,p]),J=a.useCallback(async()=>{k.current?P():await D()},[D,P]);a.useEffect(()=>{k.current&&(N().bpm.value=j)},[j]),a.useEffect(()=>{k.current&&P()},[o,v,P]),a.useEffect(()=>()=>{m.current&&(m.current.stop(),m.current.dispose(),m.current=null),N().stop(),N().cancel(),S()},[S]);const W=O(o,u.degrees);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("select",{value:o,onChange:t=>x(t.target.value),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:oe.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Progression"}),e.jsx("select",{value:v,onChange:t=>M(parseInt(t.target.value)),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:H.map(t=>e.jsx("optgroup",{label:t,children:E.map((s,r)=>s.genre===t?e.jsx("option",{value:r,children:s.name},r):null)},t))})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Tempo"}),e.jsxs("span",{className:"text-sm font-mono",style:{color:"var(--accent-primary)"},children:[j," BPM"]})]}),e.jsx("input",{type:"range",min:40,max:160,value:j,onChange:t=>z(parseInt(t.target.value)),className:"w-full"})]}),e.jsx("button",{onClick:J,className:"px-6 py-2 rounded-lg font-medium transition-colors text-white min-w-[100px]",style:{backgroundColor:I?"var(--error)":"var(--success)"},children:I?"Stop":"Play"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:u.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:u.suggestedScale})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.numerals.map((t,s)=>{const r=I&&R>=0&&p[R]?.chordIndex===s,g=W[s],C=g?g.root:"";return e.jsxs("div",{className:"flex flex-col items-center px-3 py-2 rounded-lg transition-all min-w-[48px]",style:{backgroundColor:r?"var(--accent-primary)":"var(--bg-primary)",color:r?"white":"var(--text-primary)",border:`1px solid ${r?"var(--accent-primary)":"var(--border-color)"}`,transform:r?"scale(1.1)":"scale(1)"},children:[e.jsx("span",{className:"text-sm font-bold",children:t}),e.jsx("span",{className:"text-xs opacity-70",children:C})]},s)})})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:"Walking Line"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:p.map((t,s)=>{const r=I&&s===R,g=t.note.replace(/\d+$/,""),b=s%u.beatsPerChord===0;return e.jsxs(Q.Fragment,{children:[b&&s>0&&e.jsx("span",{className:"text-xs self-center mx-0.5",style:{color:"var(--text-muted)"},children:"|"}),e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded text-xs font-mono font-medium transition-all",style:{backgroundColor:r?"var(--accent-primary)":"var(--bg-primary)",color:r?"white":"var(--text-primary)",border:`1px solid ${r?"var(--accent-primary)":"var(--border-color)"}`,transform:r?"scale(1.15)":"scale(1)"},children:g})]},s)})}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)"},children:"Pattern: Root - 3rd - 5th - Chromatic approach"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-primary)"},children:[e.jsx("input",{type:"checkbox",checked:B,onChange:t=>_(t.target.checked),className:"rounded"}),"Full fretboard"]}),e.jsx(ae,{})]}),e.jsx("div",{className:"card p-4",children:e.jsx(V,{interactive:!0})}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Practice Tips"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",style:{color:"var(--text-secondary)"},children:[e.jsx("li",{children:"Beat 1 is always the root -- anchor the harmony on the downbeat"}),e.jsx("li",{children:"Beats 2 and 3 use chord tones (3rd, 5th) to outline the chord quality"}),e.jsx("li",{children:"Beat 4 uses a chromatic approach note to lead into the next chord"}),e.jsx("li",{children:"Keep your right hand steady -- the bass drives the groove"}),e.jsx("li",{children:"Practice at slow tempos first (60-80 BPM) and build up gradually"}),e.jsx("li",{children:"Try to play along with the generated line, then create your own variations"}),e.jsx("li",{children:"Use scale passing tones between chord tones for melodic interest"})]})]}),e.jsx(ne,{exerciseId:l.id,exerciseType:l.type})]})};export{ge as default};
