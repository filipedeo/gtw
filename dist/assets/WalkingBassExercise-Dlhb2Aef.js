import{u as te,d as se,r as s,n as _,e as z,i as re,p as ae,j as e,R as ne,F as oe}from"./index-Cd-TD0Y0.js";import{a as w,s as le,L as ce,b as ie,S as de}from"./tone-BWNjRQgH.js";import{g as me,b as J,N as k}from"./theoryEngine-Ch-vsf_-.js";import{J as B}from"./jamProgressions-ClHOGlWa.js";import{D as ue}from"./DisplayModeToggle-BMJjXv4w.js";import{P as xe}from"./PracticeRating-DUHWOKm9.js";const he=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],pe={"bass-walk-1":"Blues","bass-walk-2":"Jazz","bass-walk-3":"Rock"};function H(l){const d=pe[l];if(!d)return 0;const o=B.findIndex(y=>y.genre===d);return o>=0?o:0}function ge(){const l=new Set,d=[];for(const o of B)l.has(o.genre)||(l.add(o.genre),d.push(o.genre));return d}function fe(l,d,o){const y=J(l,d),g=[];for(let c=0;c<y.length;c++){const m=y[c],P=y[(c+1)%y.length],v=k.indexOf(m.root);if(v!==-1){if(g.push({note:`${m.root}2`,chordIndex:c}),o>=2){const n=m.intervals.length>1?m.intervals[1]:4,f=(v+n)%12;g.push({note:`${k[f]}2`,chordIndex:c})}if(o>=3){const n=m.intervals.length>2?m.intervals[2]:7,f=(v+n)%12;g.push({note:`${k[f]}2`,chordIndex:c})}if(o>=4){const n=k.indexOf(P.root);if(n!==-1){const f=(n-1+12)%12;g.push({note:`${k[f]}2`,chordIndex:c})}else{const f=m.intervals.length>2?m.intervals[2]:7,j=(v+f)%12;g.push({note:`${k[j]}2`,chordIndex:c})}}}}return g}const ke=({exercise:l})=>{const{stringCount:d,tuning:o,fretCount:y,setHighlightedPositions:g,setSecondaryHighlightedPositions:c,setRootNote:m,clearHighlights:P}=te(),{isActive:v}=se(),[n,f]=s.useState("C"),[j,T]=s.useState(()=>H(l.id)),[N,W]=s.useState(120),[I,D]=s.useState(!1),[F,K]=s.useState(-1),[M,q]=s.useState(!1),x=s.useRef(null),C=s.useRef(!1),u=B[j],U=ge();s.useEffect(()=>{const t=H(l.id);T(t)},[l.id]);const $=M?y:12,h=s.useMemo(()=>fe(n,u.degrees,u.beatsPerChord),[n,u.degrees,u.beatsPerChord]),L=s.useMemo(()=>[...new Set(h.map(t=>_(t.note.replace(/\d+$/,""))))],[h]);s.useEffect(()=>{if(v)try{const t=_(n),r=me(t,u.suggestedScale);if(r&&r.length>0){const a=z(r,o,d,$);g(a),m(t);const p=z(L,o,d,$);c(p)}}catch(t){console.error("Error updating walking bass fretboard:",t)}},[n,j,M,v,d,o,$,u,L,g,c,m]);const E=s.useCallback(()=>{x.current&&(x.current.stop(),x.current.dispose(),x.current=null),w().stop(),w().cancel(),C.current=!1,D(!1),K(-1)},[]),G=s.useCallback(async()=>{if(await re(),await le(),h.length===0)return;const t=w();t.bpm.value=N,t.cancel();let r=0;x.current=new ce(a=>{const p=r%h.length,i=h[p];ie().schedule(()=>{K(p)},a);try{const b=new de({oscillator:{type:"triangle"},envelope:{attack:.01,decay:.2,sustain:.3,release:.4}}).toDestination();b.volume.value=-6,b.triggerAttackRelease(i.note,"8n",a),b.triggerRelease(a+.4),setTimeout(()=>b.dispose(),2e3)}catch{ae(i.note,{duration:.4,velocity:.7})}r=(r+1)%h.length},"4n"),x.current.start(0),t.start(),C.current=!0,D(!0)},[N,h]),X=s.useCallback(async()=>{C.current?E():await G()},[G,E]);s.useEffect(()=>{C.current&&(w().bpm.value=N)},[N]),s.useEffect(()=>{C.current&&E()},[n,j,E]),s.useEffect(()=>()=>{x.current&&(x.current.stop(),x.current.dispose(),x.current=null),w().stop(),w().cancel(),P()},[P]);const Y=J(n,u.degrees);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Key"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:he.map(t=>e.jsx("button",{onClick:()=>f(t),className:`px-3 py-2 rounded-lg font-medium transition-all min-w-[44px] ${n===t?"btn-primary":""}`,style:n!==t?{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"}:{},children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Progression"}),e.jsx("select",{value:j,onChange:t=>T(parseInt(t.target.value)),className:"w-full px-3 py-2 rounded-lg",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},children:U.map(t=>e.jsx("optgroup",{label:t,children:B.map((r,a)=>r.genre===t?e.jsx("option",{value:a,children:r.name},a):null)},t))})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Tempo"}),e.jsxs("span",{className:"text-sm font-mono",style:{color:"var(--accent-primary)"},children:[N," BPM"]})]}),e.jsx("input",{type:"range",min:40,max:160,value:N,onChange:t=>W(parseInt(t.target.value)),className:"w-full"})]}),e.jsx("button",{onClick:X,className:"px-6 py-2 rounded-lg font-medium transition-colors text-white min-w-[100px]",style:{backgroundColor:I?"var(--error)":"var(--success)"},children:I?"Stop":"Play"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:u.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:u.suggestedScale})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.numerals.map((t,r)=>{const a=I&&F>=0&&h[F]?.chordIndex===r,p=Y[r],i=p?p.root:"";return e.jsxs("div",{className:"flex flex-col items-center px-3 py-2 rounded-lg transition-all min-w-[48px]",style:{backgroundColor:a?"var(--accent-primary)":"var(--bg-primary)",color:a?"white":"var(--text-primary)",border:`1px solid ${a?"var(--accent-primary)":"var(--border-color)"}`,transform:a?"scale(1.1)":"scale(1)"},children:[e.jsx("span",{className:"text-sm font-bold",children:t}),e.jsx("span",{className:"text-xs opacity-70",children:i})]},r)})})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--accent-primary)"},children:"Walking Line"}),e.jsx("div",{className:"space-y-1.5",children:(()=>{const t=u.beatsPerChord,r=Math.ceil(h.length/t),a=4,p=[];for(let i=0;i<r;i+=a)p.push(Array.from({length:Math.min(a,r-i)},(b,S)=>i+S));return p.map((i,b)=>e.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[i.map(S=>{const A=S*t,Q=h.slice(A,A+t);return e.jsxs(ne.Fragment,{children:[S>i[0]&&e.jsx("span",{className:"text-xs self-center mx-0.5",style:{color:"var(--text-muted)"},children:"|"}),Q.map((V,Z)=>{const O=A+Z,R=I&&O===F,ee=V.note.replace(/\d+$/,"");return e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded text-xs font-mono font-medium transition-all",style:{backgroundColor:R?"var(--accent-primary)":"var(--bg-primary)",color:R?"white":"var(--text-primary)",border:`1px solid ${R?"var(--accent-primary)":"var(--border-color)"}`,transform:R?"scale(1.15)":"scale(1)"},children:ee},O)})]},S)}),e.jsx("span",{className:"text-xs self-center mx-0.5",style:{color:"var(--text-muted)"},children:"|"})]},b))})()}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)"},children:"Pattern: Root - 3rd - 5th - Chromatic approach"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-primary)"},children:[e.jsx("input",{type:"checkbox",checked:M,onChange:t=>q(t.target.checked),className:"rounded"}),"Full fretboard"]}),e.jsx(ue,{})]}),e.jsx("div",{className:"card p-4",children:e.jsx(oe,{interactive:!0})}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium mb-2",style:{color:"var(--text-primary)"},children:"Practice Tips"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",style:{color:"var(--text-secondary)"},children:[e.jsx("li",{children:"Beat 1 is always the root -- anchor the harmony on the downbeat"}),e.jsx("li",{children:"Beats 2 and 3 use chord tones (3rd, 5th) to outline the chord quality"}),e.jsx("li",{children:"Beat 4 uses a chromatic approach note to lead into the next chord"}),e.jsx("li",{children:"Keep your right hand steady -- the bass drives the groove"}),e.jsx("li",{children:"Practice at slow tempos first (60-80 BPM) and build up gradually"}),e.jsx("li",{children:"Try to play along with the generated line, then create your own variations"}),e.jsx("li",{children:"Use scale passing tones between chord tones for melodic interest"})]})]}),e.jsx(xe,{exerciseId:l.id,exerciseType:l.type})]})};export{ke as default};
